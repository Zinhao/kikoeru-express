(function(t){function e(e){for(var s,o,n=e[0],l=e[1],c=e[2],d=0,p=[];d<n.length;d++)o=n[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);u&&u(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],s=!0,o=1;o<a.length;o++){var l=a[o];0!==i[l]&&(s=!1)}s&&(r.splice(e--,1),t=n(n.s=a[0]))}return t}var s={},i={1:0},r=[];function o(t){return n.p+"js/"+({}[t]||t)+"."+{2:"052836f6"}[t]+".js"}function n(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.e=function(t){var e=[],a=i[t];if(0!==a)if(a)e.push(a[2]);else{var s=new Promise((function(e,s){a=i[t]=[e,s]}));e.push(a[2]=s);var r,l=document.createElement("script");l.charset="utf-8",l.timeout=120,n.nc&&l.setAttribute("nonce",n.nc),l.src=o(t);var c=new Error;r=function(e){l.onerror=l.onload=null,clearTimeout(d);var a=i[t];if(0!==a){if(a){var s=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",c.name="ChunkLoadError",c.type=s,c.request=r,a[1](c)}i[t]=void 0}};var d=setTimeout((function(){r({type:"timeout",target:l})}),12e4);l.onerror=l.onload=r,document.head.appendChild(l)}return Promise.all(e)},n.m=t,n.c=s,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(a,s,function(e){return t[e]}.bind(null,s));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var d=0;d<l.length;d++)e(l[d]);var u=c;r.push([0,0]),a()})({0:function(t,e,a){t.exports=a("2f39")},"104d":function(t,e){},"1f5a":function(t,e,a){"use strict";var s=a("8e3b"),i=a.n(s);i.a},"2f39":function(t,e,a){"use strict";a.r(e);a("7d6e"),a("e54f"),a("985d"),a("31cd");var s=a("2b0e"),i=a("1f91"),r=a("42d2"),o=a("b05d"),n=a("18d6"),l=a("a639"),c=a("2a19");s["default"].use(o["a"],{config:{},lang:i["a"],iconSet:r["a"],plugins:{LocalStorage:n["a"],SessionStorage:l["a"],Notify:c["a"]}});var d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"q-app"}},[a("router-view")],1)},u=[],p={name:"App"},m=p,h=a("2877"),g=Object(h["a"])(m,d,u,!1,null,null,null),f=g.exports,v=a("2f62"),w=function(){return{hide:!1,playing:!1,currentTime:0,duration:0,source:"",queue:[],queueIndex:0,playMode:{id:0,name:"order"},muted:!1,volume:0,currentLyric:"",sleepTime:null,sleepMode:!1,rewindSeekTime:5,forwardSeekTime:30,rewindSeekMode:!1,forwardSeekMode:!1}};const q={currentPlayingFile:t=>t.queue[t.queueIndex]||{hash:"",title:"",workTitle:""}};var b=q;const k={TOGGLE_HIDE(t){t.hide=!t.hide},PLAY(t){t.playing=!0},PAUSE(t){t.playing=!1},TOGGLE_PLAYING(t){t.playing=!t.playing},SET_TRACK:(t,e)=>{e>=t.queue.length||e<0||(t.playing=!0,t.queueIndex=e)},NEXT_TRACK:t=>{t.queueIndex<t.queue.length-1&&(t.playing=!0,t.queueIndex+=1)},PREVIOUS_TRACK:t=>{t.queueIndex>0&&(t.playing=!0,t.queueIndex-=1)},SET_QUEUE(t,e){t.queue=e.queue,t.queueIndex=e.index,e.resetPlaying&&(t.playing=!0)},EMPTY_QUEUE:t=>{t.playing=!1,t.queue=[],t.queueIndex=0},ADD_TO_QUEUE:(t,e)=>{t.queue.push(e)},REMOVE_FROM_QUEUE:(t,e)=>{t.queue.splice(e,1),e===t.queueIndex?(t.playing=!1,t.queueIndex=0):e<t.queueIndex&&(t.queueIndex-=1)},SET_DURATION(t,e){t.duration=e},SET_CURRENT_TIME(t,e){t.currentTime=e},PLAY_NEXT:(t,e)=>{t.queue.splice(t.queueIndex+1,0,e)},CHANGE_PLAY_MODE:t=>{const e=[{id:0,name:"order"},{id:1,name:"all repeat"},{id:2,name:"repeat once"},{id:3,name:"shuffle"}],a=t.playMode.id>=e.length-1?0:t.playMode.id+1;t.playMode=e[a]},TOGGLE_MUTED:t=>{t.muted=!t.muted},SET_VOLUME:(t,e)=>{e<0||e>1||(t.volume=e)},SET_REWIND_SEEK_TIME:(t,e)=>{t.rewindSeekTime=e},SET_FORWARD_SEEK_TIME:(t,e)=>{t.forwardSeekTime=e},SET_REWIND_SEEK_MODE:(t,e)=>{t.rewindSeekMode=e},SET_FORWARD_SEEK_MODE:(t,e)=>{t.forwardSeekMode=e},SET_CURRENT_LYRIC:(t,e)=>{t.currentLyric=e},SET_SLEEP_TIMER:(t,e)=>{t.sleepTime=e,t.sleepMode=!0},CLEAR_SLEEP_MODE:t=>{t.sleepTime=null,t.sleepMode=!1}};var y=k,_=a("6a18"),x={namespaced:!0,getters:b,mutations:y,actions:_,state:w},S=function(){return{auth:!1,name:"",group:""}},C=a("b5fb");const T={INIT(t,e){t.name=e.name,t.group=e.group},SET_AUTH(t,e){t.auth=e}};var E=T,$=a("104d"),I={namespaced:!0,state:S,getters:C,mutations:E,actions:$};s["default"].use(v["a"]);var P=function(){const t=new v["a"].Store({modules:{AudioPlayer:x,User:I},strict:!1});return t},Q=a("8c4f"),N=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{staticClass:"bg-grey-3",attrs:{view:"hHh Lpr lFf"}},[a("q-header",{staticClass:"shadow-4"},[a("q-toolbar",{staticClass:"row justify-between"},[a("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu"},on:{click:function(e){t.drawerOpen=!t.drawerOpen}}}),t.isNotAtHomePage?a("q-btn",{attrs:{flat:"",size:"md",icon:"arrow_back_ios"},on:{click:function(e){return t.back()}}}):t._e(),a("q-toolbar-title",{staticClass:"gt-xs"},[a("router-link",{staticClass:"text-white",attrs:{to:"/"}},[t._v("\n          Kikoeru\n        ")])],1),a("q-input",{staticClass:"q-mr-sm",attrs:{dark:"",dense:"",rounded:"",standout:"",debounce:"500","input-class":"text-right"},scopedSlots:t._u([{key:"append",fn:function(){return[""===t.keyword?a("q-icon",{attrs:{name:"search"}}):a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(e){t.keyword=""}}})]},proxy:!0}]),model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),a("AudioPlayer")],1),a("q-drawer",{attrs:{"show-if-above":"",mini:t.miniState,"mini-to-overlay":"",width:230,breakpoint:500,bordered:"","content-class":"bg-grey-1"},on:{mouseover:function(e){t.miniState=!1},mouseout:function(e){t.miniState=!0}},model:{value:t.drawerOpen,callback:function(e){t.drawerOpen=e},expression:"drawerOpen"}},[a("q-scroll-area",{staticClass:"fit"},[a("q-list",[t._l(t.links,(function(e,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,attrs:{clickable:"",exact:"",to:e.path,"active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.miniState=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:e.icon}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n              "+t._s(e.title)+"\n            ")])],1)],1)})),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:t.randomPlay}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"shuffle"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n              随心听\n            ")])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.showTimer=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"bedtime"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n              睡眠模式\n            ")])],1)],1)],2),a("q-list",[t.authEnabled?a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.confirm=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"exit_to_app"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n              登出\n            ")]),a("q-item-label",{attrs:{caption:"",lines:"2"}},[t._v(t._s(t.userName))])],1)],1):t._e()],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-avatar",{attrs:{icon:"power_settings_new",color:"primary","text-color":"white"}}),a("span",{staticClass:"q-ml-sm"},[t._v("是否退出登录？（若未开启用户验证，则操作无效）")])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"退出",color:"primary"},on:{click:function(e){return t.logout()}}})],1)],1)],1),a("SleepMode",{model:{value:t.showTimer,callback:function(e){t.showTimer=e},expression:"showTimer"}}),a("q-page-container",[a("keep-alive",{attrs:{include:"Works"}},[a("router-view")],1),a("q-page-scroller",{attrs:{position:"bottom-right","scroll-offset":150,offset:[18,18]}},[a("q-btn",{attrs:{fab:"",icon:"keyboard_arrow_up",color:"accent"}})],1)],1),a("q-footer",{staticClass:"q-pa-none"},[a("LyricsBar"),a("PlayerBar")],1)],1)},L=[],R=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-slide-transition",{staticClass:"bordered elevated"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.currentPlayingFile.hash&&t.hide,expression:"currentPlayingFile.hash && hide"}],staticClass:"row bg-white text-black"},[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"col non-selectable",staticStyle:{padding:"0px 5px"},attrs:{clickable:""},on:{click:function(e){return t.toggleHide()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-img",{staticClass:"rounded-borders",staticStyle:{height:"50px",width:"50px"},attrs:{transition:"fade",src:t.samCoverUrl}})],1),a("q-item-section",[a("q-item-label",{attrs:{lines:"2"}},[t._v(t._s(t.currentPlayingFile.title))]),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(t.currentPlayingFile.workTitle))])],1)],1),a("q-btn",{staticClass:"col-auto gt-sm",staticStyle:{height:"60px",width:"60px"},attrs:{flat:"",size:"lg",icon:"skip_previous"},on:{click:function(e){return t.previousTrack()}}}),a("q-btn",{staticClass:"col-auto",staticStyle:{height:"60px",width:"60px"},attrs:{flat:"",size:"lg",icon:t.playingIcon},on:{click:function(e){return t.togglePlaying()}}}),a("q-btn",{staticClass:"col-auto gt-sm",staticStyle:{height:"60px",width:"60px"},attrs:{flat:"",size:"lg",icon:"skip_next"},on:{click:function(e){return t.nextTrack()}}})],1)])},M=[],O={name:"PlayerBar",computed:{samCoverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"",e=this.currentPlayingFile.hash;return e?`/api/cover/${e.split("/")[0]}?type=sam&token=${t}`:""},playingIcon(){return this.playing?"pause":"play_arrow"},...Object(v["d"])("AudioPlayer",["hide","playing"]),...Object(v["b"])("AudioPlayer",["currentPlayingFile"])},methods:{toggleHide(){this.$store.commit("AudioPlayer/TOGGLE_HIDE")},togglePlaying(){this.$store.commit("AudioPlayer/TOGGLE_PLAYING")},nextTrack(){this.$store.commit("AudioPlayer/NEXT_TRACK")},previousTrack(){this.$store.commit("AudioPlayer/PREVIOUS_TRACK")}}},A=O,U=a("e9c1"),D=a("66e5"),F=a("4074"),j=a("068f"),B=a("0170"),z=a("9c40"),W=a("714f"),G=a("eebe"),K=a.n(G),H=Object(h["a"])(A,R,M,!1,null,null,null),V=H.exports;K()(H,"components",{QSlideTransition:U["a"],QItem:D["a"],QItemSection:F["a"],QImg:j["a"],QItemLabel:B["a"],QBtn:z["a"]}),K()(H,"directives",{Ripple:W["a"]});var Y=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("q-slide-transition",[a("q-card",{directives:[{name:"show",rawName:"v-show",value:t.currentPlayingFile.hash&&!t.hide,expression:"currentPlayingFile.hash && !hide"}],staticClass:"fixed-bottom-right bg-white text-black audio-player",attrs:{square:""},on:{mousewheel:function(t){t.preventDefault()},touchmove:function(t){t.preventDefault()}}},[a("div",{staticClass:"bg-dark row items-center albumart"},[a("q-img",{attrs:{contain:"",transition:"fade",src:t.coverUrl,ratio:4/3}}),a("q-btn",{staticClass:"absolute-top-left q-ma-sm",attrs:{dense:"",round:"",size:"md",color:"white","text-color":"dark",icon:"keyboard_arrow_down"},on:{click:function(e){return t.toggleHide()}}}),a("q-btn",{staticClass:"absolute-top-right q-ma-sm",attrs:{dense:"",round:"",size:"md",color:"white","text-color":"dark",icon:"more_vert"}},[a("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(e){t.hideSeekButton=!t.hideSeekButton}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:t.hideSeekButton?"done":""}})],1),a("q-item-section",[t._v("\n                隐藏封面按钮\n              ")])],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(e){t.swapSeekButton=!t.swapSeekButton}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:t.swapSeekButton?"done":""}})],1),a("q-item-section",[t._v("\n                交换进度按钮与切换按钮\n              ")])],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"},{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.openWorkDetail()}}},[a("q-item-section",{attrs:{avatar:""}}),a("q-item-section",[t._v("\n                打开作品详情\n              ")])],1)],1)],1),a("div",{staticClass:"row absolute q-pl-md q-pr-md col-12 justify-between"},[t.hideSeekButton?t._e():a("q-btn",{staticStyle:{opacity:"0.8"},attrs:{round:"",size:"lg",color:"white","text-color":"dark",icon:t.swapSeekButton?"skip_previous":t.rewindIcon},on:{click:function(e){t.swapSeekButton?t.previousTrack():t.rewind(!0)}}}),t.hideSeekButton?t._e():a("q-btn",{staticStyle:{opacity:"0.8"},attrs:{round:"",size:"lg",color:"white","text-color":"dark",icon:t.swapSeekButton?"skip_next":t.forwardIcon},on:{click:function(e){t.swapSeekButton?t.nextTrack():t.forward(!0)}}})],1)],1),a("div",{staticClass:"row items-center q-mx-sm q-my-sm",staticStyle:{height:"40px"}},[a("div",{staticClass:"col-auto"},[t._v(t._s(t.formatSeconds(t.currentTime)))]),a("AudioElement",{staticClass:"col"}),a("div",{staticClass:"col-auto"},[t._v(t._s(t.formatSeconds(t.duration)))])],1),t.$q.platform.is.ios?a("div",{staticStyle:{height:"5px"}}):t._e(),a("q-item",{staticClass:"text-center non-selectable",staticStyle:{height:"55px",padding:"0px 15px"}},[a("q-item-section",[a("q-item-label",{staticClass:"text-bold",attrs:{lines:"2"}},[t._v(t._s(t.currentPlayingFile.title))]),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(t.currentPlayingFile.workTitle))])],1)],1),t.$q.platform.is.ios?a("div",{staticStyle:{height:"10px"}}):t._e(),a("div",{staticClass:"row justify-around",staticStyle:{height:"65px"}},[a("q-btn",{staticClass:"col-auto",staticStyle:{width:"55px"},attrs:{flat:"",dense:"",size:"md",icon:"queue_music"},on:{click:function(e){t.showCurrentPlayList=!t.showCurrentPlayList}}}),a("q-btn",{staticClass:"col-auto",staticStyle:{width:"55px"},attrs:{flat:"",dense:"",size:"lg",icon:t.swapSeekButton?t.rewindIcon:"skip_previous"},on:{click:function(e){t.swapSeekButton?t.rewind(!0):t.previousTrack()}}}),a("q-btn",{staticClass:"col-auto",staticStyle:{width:"65px"},attrs:{flat:"",dense:"",size:"28px",icon:t.playingIcon},on:{click:function(e){return t.togglePlaying()}}}),a("q-btn",{staticClass:"col-auto",staticStyle:{width:"55px"},attrs:{flat:"",dense:"",size:"lg",icon:t.swapSeekButton?t.forwardIcon:"skip_next"},on:{click:function(e){t.swapSeekButton?t.forward(!0):t.nextTrack()}}}),a("q-btn",{staticClass:"col-auto",staticStyle:{width:"55px"},attrs:{flat:"",dense:"",size:"md",icon:t.playModeIcon},on:{click:function(e){return t.changePlayMode()}}})],1),t.$q.platform.is.ios?t._e():a("div",{staticClass:"row items-center q-mx-lg",staticStyle:{height:"50px"}},[a("q-icon",{staticClass:"col-auto",attrs:{name:"volume_down",size:"sm"}}),a("vue-slider",{staticClass:"col",attrs:{min:0,max:1,interval:.01,dragOnClick:!0,contained:!0,tooltip:"none"},model:{value:t.volume,callback:function(e){t.volume=e},expression:"volume"}}),a("q-icon",{staticClass:"col-auto",attrs:{name:"volume_up",size:"sm"}})],1)],1)],1),a("q-dialog",{model:{value:t.showCurrentPlayList,callback:function(e){t.showCurrentPlayList=e},expression:"showCurrentPlayList"}},[a("q-card",{staticClass:"current-play-list"},[a("div",{staticClass:"row",staticStyle:{padding:"5px",height:"45px"}},[a("q-btn",{staticClass:"col-auto",staticStyle:{height:"35px",width:"35px"},attrs:{dense:"",round:"",size:"md",icon:"edit",color:"primary"},on:{click:function(e){t.editCurrentPlayList=!t.editCurrentPlayList}}}),a("q-btn",{staticClass:"col-auto q-mx-sm",staticStyle:{height:"35px",width:"35px"},attrs:{dense:"",round:"",size:"md",icon:"save",color:"teal"}}),a("q-space"),a("q-btn",{staticClass:"col-auto",staticStyle:{height:"35px",width:"35px"},attrs:{dense:"",round:"",size:"md",icon:"delete_forever",color:"red"},on:{click:function(e){return t.emptyQueue()}}})],1),a("q-separator"),a("q-list",{staticClass:"scroll",staticStyle:{"max-height":"450px"}},[a("draggable",{attrs:{handle:".handle"},on:{change:function(e){return t.onMoved(e.moved)}},model:{value:t.queueCopy,callback:function(e){t.queueCopy=e},expression:"queueCopy"}},t._l(t.queueCopy,(function(e,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,staticClass:"non-selectable",staticStyle:{height:"48px",padding:"0px 10px"},attrs:{clickable:"",active:t.queueIndex===s,"active-class":"text-white bg-teal"},on:{click:function(e){return t.onClickTrack(s)}}},[a("q-item-section",{directives:[{name:"show",rawName:"v-show",value:t.editCurrentPlayList,expression:"editCurrentPlayList"}],attrs:{side:""}},[a("q-icon",{attrs:{name:"clear",color:t.queueIndex===s?"white":"red"},on:{click:function(e){return t.removeFromQueue(s)}}})],1),a("q-item-section",{attrs:{avatar:""}},[a("q-img",{staticClass:"rounded-borders",staticStyle:{height:"38px",width:"38px"},attrs:{transition:"fade",src:t.samCoverUrl(e.hash)}})],1),a("q-item-section",[a("q-item-label",{attrs:{lines:"1"}},[t._v(t._s(e.title))]),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.workTitle))])],1),a("q-item-section",{directives:[{name:"show",rawName:"v-show",value:t.editCurrentPlayList,expression:"editCurrentPlayList"}],staticClass:"handle",attrs:{side:""}},[a("q-icon",{attrs:{name:"reorder",color:t.queueIndex===s?"white":"dark"}})],1)],1)})),1)],1)],1)],1)],1)},J=[],X=a("b76a"),Z=a.n(X),tt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("vue-plyr",{ref:"plyr",attrs:{emit:["canplay","timeupdate","ended","seeked"]},on:{canplay:function(e){return t.onCanplay()},timeupdate:function(e){return t.onTimeupdate()},ended:function(e){return t.onEnded()},seeked:function(e){return t.onSeeked()}}},[a("audio",{attrs:{crossorigin:"anonymous"}},[t.source?a("source",{attrs:{src:t.source}}):t._e()])])},et=[],at=a("e6bb"),st=a.n(at),it={methods:{showSuccNotif(t){this.$q.notify({message:t,color:"positive",icon:"done",timeout:500})},showWarnNotif(t){this.$q.notify({message:t,color:"warning",icon:"warning"})},showErrNotif(t){this.$q.notify({message:t,color:"negative",icon:"bug_report"})}}},rt={name:"AudioElement",mixins:[it],data(){return{lrcObj:null,lrcAvailable:!1}},computed:{player(){return this.$refs.plyr.player},source(){const t=this.$q.localStorage.getItem("jwt-token")||"";return this.currentPlayingFile.mediaStreamUrl?`${this.currentPlayingFile.mediaStreamUrl}?token=${t}`:this.currentPlayingFile.hash?`/api/media/stream/${this.currentPlayingFile.hash}?token=${t}`:""},...Object(v["d"])("AudioPlayer",["playing","queue","queueIndex","playMode","muted","volume","sleepTime","sleepMode","rewindSeekTime","forwardSeekTime","rewindSeekMode","forwardSeekMode"]),...Object(v["b"])("AudioPlayer",["currentPlayingFile"])},watch:{playing(t){this.player.duration&&(t?this.player.play():this.player.pause()),this.playLrc(t)},source(t){t&&(this.player.media.load(),this.loadLrcFile())},muted(t){this.player.muted=t},volume(t){t<0||t>1||(this.player.volume=t)},rewindSeekMode(t){t&&(this.player.rewind(this.rewindSeekTime),this.SET_REWIND_SEEK_MODE(!1))},forwardSeekMode(t){t&&(this.player.forward(this.forwardSeekTime),this.SET_FORWARD_SEEK_MODE(!1))}},methods:{...Object(v["c"])("AudioPlayer",["SET_DURATION","SET_CURRENT_TIME","PAUSE","PLAY","SET_TRACK","NEXT_TRACK","SET_CURRENT_LYRIC","SET_VOLUME","CLEAR_SLEEP_MODE","SET_REWIND_SEEK_MODE","SET_FORWARD_SEEK_MODE"]),onCanplay(){this.SET_DURATION(this.player.duration),this.playing&&this.player.currentTime!==this.player.duration&&this.player.play()},onTimeupdate(){if(this.SET_CURRENT_TIME(this.player.currentTime),this.sleepMode&&this.sleepTime){const t=new Date,e=t.getHours().toString().padStart(2,"0"),a=t.getMinutes().toString().padStart(2,"0"),s=this.sleepTime.match(/\d+/g)[0],i=this.sleepTime.match(/\d+/g)[1];e===s&&a===i&&(this.PAUSE(),this.CLEAR_SLEEP_MODE(),this.$q.sessionStorage.set("sleepTime",null),this.$q.sessionStorage.set("sleepMode",!1))}},onEnded(){switch(this.playMode.name){case"all repeat":this.queueIndex===this.queue.length-1?this.SET_TRACK(0):this.NEXT_TRACK();break;case"repeat once":this.player.currentTime=0,this.player.play(),this.PLAY();break;case"shuffle":{const t=Math.floor(Math.random()*this.queue.length);this.SET_TRACK(t),t===this.queueIndex&&(this.player.currentTime=0);break}default:this.queueIndex===this.queue.length-1?this.PAUSE():this.NEXT_TRACK()}},onSeeked(){this.lrcAvailable&&(this.lrcObj.play(1e3*this.player.currentTime),this.playing||this.lrcObj.pause())},playLrc(t){this.lrcAvailable&&(t?this.lrcObj.play(1e3*this.player.currentTime):this.lrcObj.pause())},initLrcObj(){this.lrcObj=new st.a({onPlay:(t,e)=>{this.SET_CURRENT_LYRIC(e)}})},loadLrcFile(){const t=this.$q.localStorage.getItem("jwt-token")||"",e=this.queue[this.queueIndex].hash,a=`/api/media/check-lrc/${e}?token=${t}`;this.$axios.get(a).then(e=>{if(e.data.result){this.lrcAvailable=!0,console.log("读入歌词");const a=`/api/media/stream/${e.data.hash}?token=${t}`;this.$axios.get(a).then(t=>{console.log("歌词读入成功"),this.lrcObj.setLyric(t.data),this.lrcObj.play(1e3*this.player.currentTime)})}else this.lrcAvailable=!1,this.lrcObj.setLyric(""),this.SET_CURRENT_LYRIC("")}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}},mounted(){this.SET_VOLUME(this.player.volume),this.initLrcObj(),this.source&&this.loadLrcFile()}},ot=rt,nt=Object(h["a"])(ot,tt,et,!1,null,null,null),lt=nt.exports,ct={name:"AudioPlayer",components:{draggable:Z.a,AudioElement:lt},data(){return{showCurrentPlayList:!1,editCurrentPlayList:!1,queueCopy:[],hideSeekButton:!1,swapSeekButton:!1}},mounted(){this.$q.localStorage.has("hideSeekButton")&&(this.hideSeekButton=this.$q.localStorage.getItem("hideSeekButton")),this.$q.localStorage.has("swapSeekButton")&&(this.swapSeekButton=this.$q.localStorage.getItem("swapSeekButton"))},watch:{queue(t){this.queueCopy=t.concat(),0===this.queueCopy.length&&(this.showCurrentPlayList=!1)},showCurrentPlayList(t){!1===t&&(this.editCurrentPlayList=!1)},hideSeekButton(t){this.$q.localStorage.set("hideSeekButton",t)},swapSeekButton(t){this.$q.localStorage.set("swapSeekButton",t)}},computed:{coverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"",e=this.currentPlayingFile.hash;return e?`/api/cover/${e.split("/")[0]}?token=${t}`:""},workDetailUrl(){const t=this.currentPlayingFile.hash;return t?"/work/"+t.split("/")[0]:""},volume:{get(){return this.$store.state.AudioPlayer.volume},set(t){this.SET_VOLUME(t)}},queue:{get(){return this.$store.state.AudioPlayer.queue},set(){}},playModeIcon(){switch(this.playMode.name){case"all repeat":return"repeat";case"repeat once":return"repeat_one";case"shuffle":return"shuffle";default:return"playlist_play"}},playingIcon(){return this.playing?"pause":"play_arrow"},rewindIcon(){switch(this.rewindSeekTime){case 5:return"replay_5";case 10:return"replay_10";case 30:return"replay_30";default:return"replay_5"}},forwardIcon(){switch(this.forwardSeekTime){case 5:return"forward_5";case 10:return"forward_10";case 30:return"forward_30";default:return"forward_5"}},...Object(v["d"])("AudioPlayer",["playing","hide","currentTime","duration","queueIndex","playMode","rewindSeekTime","forwardSeekTime"]),...Object(v["b"])("AudioPlayer",["currentPlayingFile"])},methods:{...Object(v["c"])("AudioPlayer",{toggleHide:"TOGGLE_HIDE",togglePlaying:"TOGGLE_PLAYING",nextTrack:"NEXT_TRACK",previousTrack:"PREVIOUS_TRACK",changePlayMode:"CHANGE_PLAY_MODE",setVolume:"SET_VOLUME",rewind:"SET_REWIND_SEEK_MODE",forward:"SET_FORWARD_SEEK_MODE"}),...Object(v["c"])("AudioPlayer",["SET_TRACK","SET_QUEUE","REMOVE_FROM_QUEUE","EMPTY_QUEUE","SET_VOLUME"]),formatSeconds(t){let e=Math.floor(t/3600)<10?"0"+Math.floor(t/3600):Math.floor(t/3600),a=Math.floor(t/60%60)<10?"0"+Math.floor(t/60%60):Math.floor(t/60%60),s=Math.floor(t%60)<10?"0"+Math.floor(t%60):Math.floor(t%60);return"00"===e?a+":"+s:e+":"+a+":"+s},samCoverUrl(t){const e=this.$q.localStorage.getItem("jwt-token")||"";return t?`/api/cover/${t.split("/")[0]}?type=sam&token=${e}`:""},onClickTrack(t){this.editCurrentPlayList||(this.SET_TRACK(t),this.showCurrentPlayList=!1)},onMoved(t){let e=null;e=t.oldIndex===this.queueIndex?t.newIndex:t.oldIndex<this.queueIndex&&t.newIndex>=this.queueIndex?this.queueIndex-1:t.oldIndex>this.queueIndex&&t.newIndex<=this.queueIndex?this.queueIndex+1:this.queueIndex,this.SET_QUEUE({queue:this.queueCopy.concat(),index:e,resetPlaying:!1})},removeFromQueue(t){this.REMOVE_FROM_QUEUE(t)},emptyQueue(){this.EMPTY_QUEUE()},openWorkDetail(){this.workDetailUrl&&this.$route.path!==this.workDetailUrl&&this.$router.push(this.workDetailUrl),this.$q.screen.lt.sm&&this.toggleHide()}}},dt=ct,ut=(a("d000"),a("f09f")),pt=a("4e73"),mt=a("0016"),ht=a("24e8"),gt=a("2c91"),ft=a("eb85"),vt=a("1c1c"),wt=a("7f67"),qt=Object(h["a"])(dt,Y,J,!1,null,"6d806e38",null),bt=qt.exports;K()(qt,"components",{QSlideTransition:U["a"],QCard:ut["a"],QImg:j["a"],QBtn:z["a"],QMenu:pt["a"],QItem:D["a"],QItemSection:F["a"],QIcon:mt["a"],QItemLabel:B["a"],QDialog:ht["a"],QSpace:gt["a"],QSeparator:ft["a"],QList:vt["a"]}),K()(qt,"directives",{Ripple:W["a"],ClosePopup:wt["a"]});var kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Moveable",t._b({on:{drag:t.handleDrag}},"Moveable",t.moveable,!1),[a("q-card",[a("div",{staticClass:"text-center text-h6 text-bold ellipsis-2-lines text-purple q-mb-md absolute-bottom",attrs:{id:"lyricsBar"}},[a("span",{attrs:{id:"lyric"}},[t._v("\n            "+t._s(t.currentLyric)+"\n          ")])])])],1)},yt=[],_t=a("9e77"),xt=a.n(_t),St={name:"LyricsBar",components:{Moveable:xt.a},computed:{...Object(v["d"])("AudioPlayer",["currentLyric"])},data(){return{moveable:{draggable:!0}}},methods:{handleDrag({target:t,transform:e}){t.style.transform=e}}},Ct=St,Tt=(a("b3a5"),Object(h["a"])(Ct,kt,yt,!1,null,null,null)),Et=Tt.exports;K()(Tt,"components",{QCard:ut["a"]});var $t=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-dialog",{attrs:{value:t.value,persistent:""},on:{input:function(e){return t.$emit("input")}}},[a("q-card",[a("div",{staticClass:"q-pa-sm"},[a("q-time",{attrs:{"now-btn":"",dark:t.sleepMode},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),a("div",{staticClass:"row justify-between"},[a("q-card-actions",[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消定时",color:"primary",disable:!t.sleepMode},on:{click:t.clearSleepTimer}})],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定",color:"primary"},on:{click:t.setSleepTimer}})],1)],1)])],1)},It=[],Pt={name:"SleepMode",props:["value"],data(){return{time:"00:00"}},computed:{...Object(v["d"])("AudioPlayer",["sleepTime","sleepMode"])},mounted(){try{this.$q.sessionStorage.getItem("sleepMode")&&this.SET_SLEEP_TIMER(this.$q.sessionStorage.getItem("sleepTime"))}catch{console.log("Web Storage API error")}},watch:{value(t){if(t)if(this.sleepMode)this.time=this.sleepTime;else{const t=new Date;this.time=t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")}}},methods:{...Object(v["c"])("AudioPlayer",["SET_SLEEP_TIMER","CLEAR_SLEEP_MODE"]),setSleepTimer(){this.SET_SLEEP_TIMER(this.time);try{this.$q.sessionStorage.set("sleepTime",this.time),this.$q.sessionStorage.set("sleepMode",!0)}catch{console.log("Web Storage API error")}this.showSuccNotif(`将于${this.time}停止播放`)},clearSleepTimer(){this.CLEAR_SLEEP_MODE();try{this.$q.sessionStorage.set("sleepTime",null),this.$q.sessionStorage.set("sleepMode",!1)}catch{console.log("Web Storage API error")}this.showSuccNotif("已关闭睡眠模式")},showSuccNotif(t){this.$q.notify({message:t,color:"primary",icon:"bedtime",timeout:5e3})}}},Qt=Pt,Nt=a("ca78"),Lt=a("4b7e"),Rt=Object(h["a"])(Qt,$t,It,!1,null,null,null),Mt=Rt.exports;K()(Rt,"components",{QDialog:ht["a"],QCard:ut["a"],QTime:Nt["a"],QCardActions:Lt["a"],QBtn:z["a"]}),K()(Rt,"directives",{ClosePopup:wt["a"]});var Ot={name:"MainLayout",mixins:[it],components:{PlayerBar:V,AudioPlayer:bt,LyricsBar:Et,SleepMode:Mt},data(){return{keyword:"",drawerOpen:!1,miniState:!0,confirm:!1,randId:null,showTimer:!1,links:[{title:"媒体库",icon:"widgets",path:"/"},{title:"我的收藏",icon:"favorite",path:"/favourites"},{title:"社团",icon:"group",path:"/circles"},{title:"标签",icon:"label",path:"/tags"},{title:"声优",icon:"mic",path:"/vas"},{title:"设定",icon:"tune",path:"/admin"}],sharedConfig:{}}},watch:{keyword(){this.$router.push(this.keyword?"/works?keyword="+this.keyword:"/works")},randId(){this.$router.push("/work/"+this.randId)},sharedConfig(t){this.SET_REWIND_SEEK_TIME(t.rewindSeekTime),this.SET_FORWARD_SEEK_TIME(t.forwardSeekTime)}},mounted(){this.initUser(),this.checkUpdate(),this.readSharedConfig()},computed:{isNotAtHomePage(){const t=this.$route.path;return t&&"/"!==t&&"/works"!==t&&"/favourites"!==t},...Object(v["d"])("User",{userName:"name",authEnabled:"auth"})},methods:{...Object(v["c"])("AudioPlayer",["SET_REWIND_SEEK_TIME","SET_FORWARD_SEEK_TIME"]),initUser(){this.$axios.get("/api/auth/me").then(t=>{this.$store.commit("User/INIT",t.data.user),this.$store.commit("User/SET_AUTH",t.data.auth)}).catch(t=>{if(t.response)if(401===t.response.status){const t=this.$router.currentRoute.path;"/login"!==t&&this.$router.push("/login")}else this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`);else this.showErrNotif(t.message||t)})},checkUpdate(){this.$axios.get("/api/version").then(t=>{t.data.update_available&&t.data.notifyUser&&this.$q.notify({message:"GitHub上有新版本",color:"primary",textColor:"white",icon:"cloud_download",timeout:5e3,actions:[{label:"好",color:"white"},{label:"查看",color:"white",handler:()=>{Object.assign(document.createElement("a"),{target:"_blank",href:"https://github.com/umonaca/kikoeru-express/releases"}).click()}}]}),t.data.lockFileExists&&this.$q.notify({message:t.data.lockReason,type:"warning",timeout:6e4,actions:[{label:"以后提醒我",color:"black"},{label:"前往扫描页",color:"black",handler:()=>this.$router.push("/admin/scanner")}]})}).catch(t=>{console.error(t)})},readSharedConfig(){this.$axios.get("/api/config/shared").then(t=>{this.sharedConfig=t.data.sharedConfig}).catch(t=>{if(t.response)if(401===t.response.status){const t=this.$router.currentRoute.path;"/login"!==t&&this.$router.push("/login")}else this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`);else this.showErrNotif(t.message||t)})},randomPlay(){this.requestRandomWork()},requestRandomWork(){const t={order:"betterRandom"};this.$axios.get("/api/works",{params:t}).then(t=>{const e=t.data.works;this.randId=e.length?e[0].id:null}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},logout(){this.$q.localStorage.set("jwt-token",""),this.$router.push("/login")},back(){this.$router.go(-1)}}},At=Ot,Ut=(a("89d3"),a("4d5a")),Dt=a("e359"),Ft=a("65c6"),jt=a("6ac5"),Bt=a("27f9"),zt=a("9404"),Wt=a("4983"),Gt=a("a370"),Kt=a("cb32"),Ht=a("09e3"),Vt=a("9989"),Yt=a("5096"),Jt=a("7ff0"),Xt=Object(h["a"])(At,N,L,!1,null,null,null),Zt=Xt.exports;K()(Xt,"components",{QLayout:Ut["a"],QHeader:Dt["a"],QToolbar:Ft["a"],QBtn:z["a"],QToolbarTitle:jt["a"],QInput:Bt["a"],QIcon:mt["a"],QDrawer:zt["a"],QScrollArea:Wt["a"],QList:vt["a"],QItem:D["a"],QItemSection:F["a"],QItemLabel:B["a"],QDialog:ht["a"],QCard:ut["a"],QCardSection:Gt["a"],QAvatar:Kt["a"],QCardActions:Lt["a"],QPageContainer:Ht["a"],QPage:Vt["a"],QPageScroller:Yt["a"],QFooter:Jt["a"]}),K()(Xt,"directives",{Ripple:W["a"],ClosePopup:wt["a"]});var te=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{attrs:{view:"hhh LpR fFf"}},[a("q-header",{staticClass:"bg-black",attrs:{elevated:""}},[a("q-toolbar",[a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"menu"},on:{click:function(e){t.drawer=!t.drawer}}}),a("q-toolbar-title",[t._v("仪表盘")])],1)],1),a("q-drawer",{attrs:{"show-if-above":"",mini:t.miniState,"mini-to-overlay":"",width:200,breakpoint:500,bordered:"","content-class":"bg-grey-3"},on:{mouseover:function(e){t.miniState=!1},mouseout:function(e){t.miniState=!0}},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[a("div",{staticClass:"column justify-between fit"},[a("q-list",{staticClass:"col-auto",attrs:{padding:""}},t._l(t.links,(function(e,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,staticClass:"col text-subtitle1",attrs:{clickable:"",exact:"",to:e.path,"active-class":"text-primary text-weight-bold"}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:e.icon}})],1),a("q-item-section",[t._v("\n            "+t._s(e.title)+"\n          ")])],1)})),1)],1)]),a("q-page-container",[a("router-view")],1)],1)},ee=[],ae={name:"DashboardLayout",mixins:[it],data(){return{drawer:!1,miniState:!0,links:[{title:"音声库",icon:"folder",path:"/admin"},{title:"扫描",icon:"youtube_searched_for",path:"/admin/scanner"},{title:"用户管理",icon:"person",path:"/admin/usermanage"},{title:"高级设置",icon:"settings",path:"/admin/advanced"},{title:"回到主页",icon:"home",path:"/"}]}},sockets:{success(t){this.showSuccNotif(t.message),t.auth&&(this.$store.commit("User/INIT",t.user),this.$store.commit("User/SET_AUTH",t.auth))},error(t){this.showWarnNotif(t.message||t),this.$socket.close(),this.$router.push("/login")}},created(){const t=this.$q.localStorage.getItem("jwt-token")||"";this.$socket.io.opts.query.auth_token=t,this.$socket.connected||this.$socket.open()}},se=ae,ie=(a("38ca"),Object(h["a"])(se,te,ee,!1,null,"1af00154",null)),re=ie.exports;K()(ie,"components",{QLayout:Ut["a"],QHeader:Dt["a"],QToolbar:Ft["a"],QBtn:z["a"],QToolbarTitle:jt["a"],QDrawer:zt["a"],QList:vt["a"],QItem:D["a"],QItemSection:F["a"],QIcon:mt["a"],QPageContainer:Ht["a"]}),K()(ie,"directives",{Ripple:W["a"]});var oe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"text-h5 text-weight-regular q-ma-md"},[t._v("\n    "+t._s(t.pageTitle)+"\n    "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.pagination.totalCount,expression:"pagination.totalCount"}]},[t._v("\n      ("+t._s(t.pagination.totalCount)+")\n    ")])]),a("div",{class:"row justify-center "+(t.listMode?"list":"q-mx-md")},[a("q-infinite-scroll",{staticClass:"col",staticStyle:{"max-width":"1680px"},attrs:{offset:250,disable:t.stopLoad},on:{load:t.onLoad},scopedSlots:t._u([{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}])},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.works.length,expression:"works.length"}],staticClass:"row justify-between q-mb-md q-mr-sm"},[a("q-select",{staticClass:"col-auto",attrs:{dense:"",rounded:"",outlined:"","bg-color":"white","transition-show":"scale","transition-hide":"scale",options:t.options,label:"排序"},model:{value:t.sortOption,callback:function(e){t.sortOption=e},expression:"sortOption"}}),a("q-btn-toggle",{staticClass:"col-auto",staticStyle:{width:"85px"},attrs:{dense:"",spread:"",rounded:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"apps",value:!1},{icon:"list",value:!0}]},model:{value:t.listMode,callback:function(e){t.listMode=e},expression:"listMode"}}),t.$q.screen.width>700&&t.listMode?a("q-btn-toggle",{staticClass:"col-auto",staticStyle:{width:"85px"},attrs:{dense:"",spread:"",rounded:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"label",value:!0},{icon:"label_off",value:!1}]},model:{value:t.showLabel,callback:function(e){t.showLabel=e},expression:"showLabel"}}):t._e(),t.$q.screen.width>700&&!t.listMode?a("q-btn-toggle",{staticClass:"col-auto",staticStyle:{width:"85px"},attrs:{dense:"",spread:"",rounded:"",disable:t.$q.screen.width<1120,"toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"zoom_in",value:!0},{icon:"zoom_out",value:!1}]},model:{value:t.detailMode,callback:function(e){t.detailMode=e},expression:"detailMode"}}):t._e()],1),t.listMode?a("q-list",{staticClass:"shadow-2",attrs:{bordered:"",separator:""}},t._l(t.works,(function(e){return a("WorkListItem",{key:e.id,attrs:{metadata:e,showLabel:t.showLabel&&t.$q.screen.width>700}})})),1):a("div",{staticClass:"row q-col-gutter-x-md q-col-gutter-y-lg"},t._l(t.works,(function(e){return a("div",{key:e.id,staticClass:"col-xs-12 col-sm-6 col-md-4",class:t.detailMode?"col-lg-3 col-xl-3":"col-lg-2 col-xl-2"},[a("WorkCard",{staticClass:"fit",attrs:{metadata:e,thumbnailMode:!t.detailMode}})],1)})),0),a("div",{directives:[{name:"show",rawName:"v-show",value:t.stopLoad,expression:"stopLoad"}],staticClass:"q-mt-lg q-mb-xl text-h6 text-bold text-center"},[t._v("END")])],1)],1)])},ne=[],le=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",[a("router-link",{attrs:{to:"/work/"+t.metadata.id}},[a("CoverSFW",{attrs:{workid:t.metadata.id,nsfw:!1,release:t.metadata.release}})],1),a("q-separator"),t.thumbnailMode?t._e():a("div",[a("div",{staticClass:"q-mx-sm text-h6 text-weight-regular ellipsis-2-lines"},[a("router-link",{staticClass:"text-black",attrs:{to:"/work/"+t.metadata.id}},[t._v("\n        "+t._s(t.metadata.title)+"\n      ")])],1),a("div",{staticClass:"q-ml-sm q-mt-sm q-mb-xs text-subtitle1 text-weight-regular ellipsis"},[a("router-link",{staticClass:"text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n        "+t._s(t.metadata.circle.name)+"\n      ")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.metadata.title,expression:"metadata.title"}],staticClass:"row items-center"},[a("div",{staticClass:"col-auto q-ml-sm"},[a("q-rating",{attrs:{size:"sm",color:t.userMarked?"blue":"amber",icon:"star_border","icon-selected":"star","icon-half":"star_half"},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),t.metadata.rate_count_detail?a("q-tooltip",{attrs:{"content-class":"text-subtitle1"}},[a("div",[t._v("平均: "+t._s(t.metadata.rate_average_2dp))]),t._l(t.sortedRatings,(function(e,s){return a("div",{key:s,staticClass:"row items-center"},[a("div",{staticClass:"col"},[t._v(t._s(e.review_point)+"星")]),a("q-linear-progress",{staticClass:"col-auto",staticStyle:{height:"15px",width:"100px"},attrs:{value:e.ratio/100,color:"amber","track-color":"white"}}),a("div",{staticClass:"col q-mx-sm"},[t._v("("+t._s(e.count)+")")])],1)}))],2):t._e()],1),a("div",{staticClass:"col-auto"},[a("span",{staticClass:"text-weight-medium text-body1 text-red"},[t._v(t._s(t.metadata.rate_average_2dp))]),a("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.rate_count)+")")])]),a("div",{staticClass:"col-auto q-px-sm"},[a("q-icon",{attrs:{name:"chat",size:"xs"}}),a("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.review_count)+")")])],1),a("div",{staticClass:"col-auto"},[a("q-icon",{attrs:{name:"launch",size:"xs"}}),a("a",{staticClass:"text-blue",attrs:{href:"https://www.dlsite.com/home/work/=/product_id/RJ"+String(t.metadata.id).padStart(6,"0")+".html",rel:"noreferrer noopener",target:"_blank"}},[t._v("DLsite")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.metadata.title,expression:"metadata.title"}]},[a("span",{staticClass:"q-mx-sm text-weight-medium text-h6 text-red"},[t._v(t._s(t.metadata.price)+" 日元")]),a("span",[t._v("售出数: "+t._s(t.metadata.dl_count))]),t.metadata.nsfw?t._e():a("span",{staticClass:"q-mx-sm",staticStyle:{background:"#e6f7d6",color:"#56842a"}},[t._v("全年龄")])]),t.showTags?a("div",{staticClass:"q-ma-xs"},t._l(t.metadata.tags,(function(e,s){return a("router-link",{key:s,attrs:{to:"/works?tagId="+e.id}},[a("q-chip",{staticClass:"shadow-2",attrs:{size:"md"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1):t._e(),a("div",{staticClass:"q-mx-xs q-my-sm"},t._l(t.metadata.vas,(function(e,s){return a("router-link",{key:s,attrs:{to:"/works?vaId="+e.id}},[a("q-chip",{staticClass:"shadow-2",attrs:{square:"",size:"md",color:"teal","text-color":"white"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1)])],1)},ce=[],de=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("router-link",{attrs:{to:"/work/"+t.workid}},[a("q-img",{staticStyle:{"max-width":"560px"},attrs:{src:t.coverUrl,ratio:4/3,"img-class":t.imgClass,transition:"fade"},on:{mouseover:function(e){return t.toggleBlurFlag()},mouseout:function(e){return t.toggleBlurFlag()}}},[a("div",{staticClass:"absolute-top-left transparent",staticStyle:{padding:"0"}},[a("q-chip",{staticClass:"q-ma-sm",attrs:{dense:"",square:"",color:"brown","text-color":"white"}},[t._v("\n        "+t._s("RJ"+t.rjcode)+"\n      ")])],1),a("div",{staticClass:"absolute-bottom-right",staticStyle:{padding:"5px"},attrs:{"v-if":t.release}},[t._v("\n      "+t._s(t.release)+"\n    ")])])],1)},ue=[],pe={name:"CoverSFW",props:{workid:{type:Number,required:!0},nsfw:{type:Boolean,default:!0},release:{required:!0}},data(){return{blurFlag:!0}},computed:{coverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"";return this.workid?`/api/cover/${this.workid}?token=${t}`:""},rjcode(){return("00"+this.workid).slice(-8)},imgClass(){return this.$q.platform.is.mobile?"":this.nsfw&&this.blurFlag?"blur-image":""}},methods:{toggleBlurFlag(){this.blurFlag=!this.blurFlag}}},me=pe,he=(a("1f5a"),a("b047")),ge=Object(h["a"])(me,de,ue,!1,null,null,null),fe=ge.exports;K()(ge,"components",{QImg:j["a"],QChip:he["a"]});var ve={name:"WorkCard",mixins:[it],components:{CoverSFW:fe},props:{metadata:{type:Object,required:!0},thumbnailMode:{type:Boolean,default:!1}},data(){return{rating:0,userMarked:!1,showTags:!0}},computed:{sortedRatings:function(){function t(t,e){return t.review_point>e.review_point?-1:1}return this.metadata.rate_count_detail.slice().sort(t)}},mounted(){this.metadata.userRating?(this.userMarked=!0,this.rating=this.metadata.userRating):(this.userMarked=!1,this.rating=this.metadata.rate_average_2dp||0),this.metadata.tags&&null===this.metadata.tags[0].name&&(this.showTags=!1)},watch:{rating(t,e){if(e){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:t};this.userMarked=!0,this.submitRating(e)}}},methods:{submitRating(t){this.$axios.put("/api/review",t).then(t=>{this.showSuccNotif(t.data.message)}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},we=ve,qe=a("daf4"),be=a("05c0"),ke=a("6b1d"),ye=Object(h["a"])(we,le,ce,!1,null,null,null),_e=ye.exports;K()(ye,"components",{QCard:ut["a"],QSeparator:ft["a"],QRating:qe["a"],QTooltip:be["a"],QLinearProgress:ke["a"],QIcon:mt["a"],QChip:he["a"]});var xe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-item",{staticClass:"bg-white",staticStyle:{padding:"5px"},attrs:{clickable:"",to:"/work/"+t.metadata.id}},[a("q-item-section",{staticStyle:{padding:"0px 5px 0px 0px"},attrs:{avatar:""}},[a("router-link",{attrs:{to:"/work/"+t.metadata.id}},[a("q-img",{staticStyle:{height:"60px",width:"60px"},attrs:{transition:"fade",src:t.samCoverUrl}})],1)],1),a("q-item-section",[a("q-item-label",{staticClass:"text",attrs:{lines:"2"}},[a("router-link",{staticClass:"text-black",attrs:{to:"/work/"+t.metadata.id}},[t._v("\n        "+t._s(t.metadata.title)+"\n      ")])],1),a("q-item-label",[a("div",{staticClass:"row q-gutter-x-sm q-gutter-y-xs"},[a("router-link",{staticClass:"col-auto text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n          "+t._s(t.metadata.circle.name)+"\n        ")]),a("span",{staticClass:"col-auto"},[t._v("/")]),t._l(t.metadata.vas,(function(e,s){return a("router-link",{key:s,staticClass:"col-auto text-primary",attrs:{to:"/works?vaId="+e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])}))],2)]),t.showLabel&&t.$q.screen.width>700?a("q-item-label",[a("div",{staticClass:"row q-gutter-x-sm q-gutter-y-xs"},t._l(t.metadata.tags,(function(e,s){return a("router-link",{key:s,staticClass:"col-auto text-grey",attrs:{to:"/works?tagId="+e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])})),1)]):t._e()],1)],1)},Se=[],Ce={name:"WorkListItem",props:{metadata:{type:Object,required:!0},showLabel:{type:Boolean,default:!0}},computed:{samCoverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"";return this.metadata.id?`/api/cover/${this.metadata.id}?type=sam&token=${t}`:""}}},Te=Ce,Ee=Object(h["a"])(Te,xe,Se,!1,null,null,null),$e=Ee.exports;K()(Ee,"components",{QItem:D["a"],QItemSection:F["a"],QImg:j["a"],QItemLabel:B["a"]});var Ie={name:"Works",mixins:[it],components:{WorkCard:_e,WorkListItem:$e},data(){return{listMode:!1,showLabel:!0,detailMode:!0,stopLoad:!1,works:[],pageTitle:"",page:1,pagination:{currentPage:0,pageSize:12,totalCount:0},seed:7,sortOption:{label:"按照发售日期新到老的顺序",order:"release",sort:"desc"},options:[{label:"按照发售日期新到老的顺序",order:"release",sort:"desc"},{label:"按照我的评价排序",order:"rating",sort:"desc"},{label:"按照发售日期老到新的顺序",order:"release",sort:"asc"},{label:"按照售出数量多到少的顺序",order:"dl_count",sort:"desc"},{label:"按照价格便宜到贵的顺序",order:"price",sort:"asc"},{label:"按照价格贵到便宜的顺序",order:"price",sort:"desc"},{label:"按照评价高到低的顺序",order:"rate_average_2dp",sort:"desc"},{label:"按照评论多到少的顺序",order:"review_count",sort:"desc"},{label:"按照RJ号大到小的顺序",order:"id",sort:"desc"},{label:"按照RJ号小到大的顺序",order:"id",sort:"asc"},{label:"按照全年龄新作优先的顺序",order:"nsfw",sort:"asc"},{label:"随机排序",order:"random",sort:"desc"}]}},created(){this.refreshPageTitle(),this.seed=Math.floor(100*Math.random())},mounted(){if(localStorage.sortOption)try{this.sortOption=JSON.parse(localStorage.sortOption)}catch{localStorage.removeItem("sortOption")}localStorage.showLabel&&(this.showLabel="true"===localStorage.showLabel),localStorage.listMode&&(this.listMode="true"===localStorage.listMode),localStorage.detailMode&&(this.detailMode="true"===localStorage.detailMode)},computed:{url(){const t=this.$route.query;return t.circleId?`/api/circles/${this.$route.query.circleId}/works`:t.tagId?`/api/tags/${this.$route.query.tagId}/works`:t.vaId?`/api/vas/${this.$route.query.vaId}/works`:t.keyword?"/api/search/"+t.keyword:"/api/works"}},activated(){this.stopLoad=!1},deactivated(){this.stopLoad=!0},watch:{url(){this.reset()},sortOption(t){localStorage.sortOption=JSON.stringify(t),this.seed=Math.floor(100*Math.random()),this.reset()},showLabel(t){localStorage.showLabel=t},listMode(t){localStorage.listMode=t},detailMode(t){localStorage.detailMode=t}},methods:{onLoad(t,e){this.requestWorksQueue().then(()=>e())},requestWorksQueue(){const t={order:this.sortOption.order,sort:this.sortOption.sort,page:this.pagination.currentPage+1||1,seed:this.seed};return this.$axios.get(this.url,{params:t}).then(e=>{const a=e.data.works;this.works=1===t.page?a.concat():this.works.concat(a),this.pagination=e.data.pagination,this.works.length>=this.pagination.totalCount&&(this.stopLoad=!0)}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t),this.stopLoad=!0})},refreshPageTitle(){if(this.$route.query.circleId||this.$route.query.tagId||this.$route.query.vaId){let t="",e="";this.$route.query.circleId?(e="circles",t=`/api/${e}/${this.$route.query.circleId}`):this.$route.query.tagId?(e="tags",t=`/api/${e}/${this.$route.query.tagId}`):(e="vas",t=`/api/${e}/${this.$route.query.vaId}`),this.$axios.get(t).then(t=>{const a=t.data.name;let s;switch(e){case"tags":s="Works tagged with ";break;case"vas":s="Works voiced by ";break;case"circles":s="Works by ";break}s+=a||"",this.pageTitle=s}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}else this.$route.query.keyword?this.pageTitle="Search by "+this.$route.query.keyword:this.pageTitle="All works"},reset(){this.stopLoad=!0,this.refreshPageTitle(),this.pagination={currentPage:0,pageSize:12,totalCount:0},this.requestWorksQueue().then(()=>{this.stopLoad=!1})}}},Pe=Ie,Qe=(a("d846"),a("ef35")),Ne=a("ddd8"),Le=a("6a67"),Re=a("8380"),Me=Object(h["a"])(Pe,oe,ne,!1,null,"33e302de",null),Oe=Me.exports;K()(Me,"components",{QInfiniteScroll:Qe["a"],QSelect:Ne["a"],QBtnToggle:Le["a"],QList:vt["a"],QSpinnerDots:Re["a"]});var Ae=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("WorkDetails",{attrs:{metadata:t.metadata},on:{reset:function(e){return t.requestData()}}}),a("WorkTree",{attrs:{tree:t.tree,editable:!1}})],1)},Ue=[],De=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("router-link",{attrs:{to:"/work/"+t.metadata.id}},[a("CoverSFW",{attrs:{workid:t.metadata.id,nsfw:!1,release:t.metadata.release}})],1),a("div",{staticClass:"q-pa-sm"},[a("div",{staticClass:"q-px-sm q-py-none"},[a("div",{staticClass:"text-h6 text-weight-regular"},[a("router-link",{staticClass:"text-black",attrs:{to:"/work/"+t.metadata.id}},[t._v("\n          "+t._s(t.metadata.title)+"\n        ")])],1),a("div",{staticClass:"text-subtitle1 text-weight-regular"},[a("router-link",{staticClass:"text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n          "+t._s(t.metadata.circle.name)+"\n        ")])],1),a("div",{staticClass:"row items-center q-gutter-xs"},[a("div",{staticClass:"col-auto"},[a("q-rating",{attrs:{name:"rating",size:"sm",color:t.userMarked?"blue":"amber",icon:"star_border","icon-selected":"star","icon-half":"star_half"},on:{input:t.setRating},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),t.metadata.rate_count_detail?a("q-tooltip",{attrs:{"content-class":"text-subtitle1"}},[a("div",[t._v("平均: "+t._s(t.metadata.rate_average_2dp))]),t._l(t.sortedRatings,(function(e,s){return a("div",{key:s,staticClass:"row items-center"},[a("div",{staticClass:"col"},[t._v(" "+t._s(e.review_point)+"星 ")]),a("q-linear-progress",{staticClass:"col-auto",staticStyle:{height:"15px",width:"100px"},attrs:{value:e.ratio/100,color:"amber","track-color":"white"}}),a("div",{staticClass:"col q-mx-sm"},[t._v(" ("+t._s(e.count)+") ")])],1)}))],2):t._e()],1),a("div",{staticClass:"col-auto"},[a("span",{staticClass:"text-weight-medium text-body1 text-red"},[t._v(t._s(t.metadata.rate_average_2dp))]),a("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.rate_count)+")")])]),a("div",{staticClass:"col-auto q-px-sm"},[a("q-icon",{attrs:{name:"chat",size:"xs"}}),a("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.review_count)+")")])],1),a("div",{staticClass:"col-auto"},[a("q-icon",{attrs:{name:"launch",size:"xs"}}),a("a",{staticClass:"text-blue",attrs:{href:"https://www.dlsite.com/home/work/=/product_id/RJ"+String(t.metadata.id).padStart(6,"0")+".html",rel:"noreferrer noopener",target:"_blank"}},[t._v("DLsite")])],1)])]),a("div",{staticClass:"q-pt-sm q-pb-none"},[a("span",{staticClass:"q-mx-sm text-weight-medium text-h6 text-red"},[t._v(t._s(t.metadata.price)+" 日元")]),t._v(" 售出数: "+t._s(t.metadata.dl_count)+"\n    ")]),t.showTags?a("div",{staticClass:"q-px-none q-py-sm"},t._l(t.metadata.tags,(function(e,s){return a("router-link",{key:s,attrs:{to:"/works?tagId="+e.id}},[a("q-chip",{staticClass:"shadow-4",attrs:{size:"md"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1):t._e(),a("div",{staticClass:"q-px-none q-pt-sm q-py-sm"},t._l(t.metadata.vas,(function(e,s){return a("router-link",{key:s,attrs:{to:"/works?vaId="+e.id}},[a("q-chip",{staticClass:"shadow-4",attrs:{square:"",size:"md",color:"teal","text-color":"white"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1),a("q-btn-dropdown",{staticClass:"q-mt-sm shadow-4 q-mx-xs q-pl-sm",attrs:{dense:"",color:"cyan",label:"标记进度"}},[a("q-list",[a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("marked")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"marked"===t.progress,expression:"progress === 'marked'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("想听")])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("listening")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"listening"===t.progress,expression:"progress === 'listening'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("在听")])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("listened")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"listened"===t.progress,expression:"progress === 'listened'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("听过")])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("replay")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"replay"===t.progress,expression:"progress === 'replay'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("重听")])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("postponed")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"postponed"===t.progress,expression:"progress === 'postponed'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("搁置")])],1)],1)],1)],1),a("q-btn",{attrs:{dense:"",color:"cyan q-mt-sm shadow-4 q-mx-xs q-px-sm",label:"写评论"},on:{click:function(e){t.showReviewDialog=!0}}}),t.showReviewDialog?a("WriteReview",{attrs:{workid:t.metadata.id,metadata:t.metadata},on:{closed:t.processReview}}):t._e()],1)],1)},Fe=[],je=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("q-dialog",{on:{hide:t.closeDialog},model:{value:t.showReviewDialog,callback:function(e){t.showReviewDialog=e},expression:"showReviewDialog"}},[a("q-card",[a("q-card-section",{staticClass:"q-pb-sm"},[a("div",{staticClass:"text-body1"},[t._v("我的评论")])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-rating",{staticClass:"col-auto",attrs:{size:"sm",color:"blue",icon:"star_border","icon-selected":"star","icon-half":"star_half"},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),a("q-btn-toggle",{class:t.$q.screen.lt.sm?"my-custom-toggle q-mx-none q-mt-sm":"my-custom-toggle q-mx-md",attrs:{"no-caps":"",rounded:"",unelevated:"",padding:t.$q.screen.width<400?"sm":"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:"想听",value:"marked"},{label:"在听",value:"listening"},{label:"听过",value:"listened"},{label:"重听",value:"replay"},{label:"搁置",value:"postponed"}]},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}})],1),a("q-card-section",{staticClass:"q-pt-none"},[a("div",{staticStyle:{"min-width":"300px"}},[a("q-input",{attrs:{filled:"",type:"textarea"},model:{value:t.reviewText,callback:function(e){t.reviewText=e},expression:"reviewText"}})],1)]),a("div",{staticClass:"row justify-between"},[a("q-card-actions",{staticClass:"text-red"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"删除标记"},on:{click:function(e){t.deleteConfirm=!0}}})],1),a("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定"},on:{click:function(e){return t.submitReview()}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"},on:{click:function(e){return t.closeDialog()}}})],1)],1)],1)],1),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.deleteConfirm,callback:function(e){t.deleteConfirm=e},expression:"deleteConfirm"}},[a("q-card",{staticClass:"bg-teal text-white",staticStyle:{width:"300px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("确定要删除标记吗")])]),a("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定"},on:{click:function(e){return t.deleteReview()}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"},on:{click:function(e){return t.closeDialog()}}})],1)],1)],1)],1)},Be=[],ze={name:"WriteReview",mixins:[it],props:{workid:{type:Number,required:!0},metadata:{type:Object,default:null}},data(){return{showReviewDialog:!0,deleteConfirm:!1,rating:0,reviewText:"",modified:!1,progress:""}},mounted(){this.metadata.userRating&&(this.rating=this.metadata.userRating),this.progress=this.metadata.progress,this.reviewText=this.metadata.review_text},methods:{closeDialog(){this.deleteConfirm||(this.modified?this.$emit("closed",!0):this.$emit("closed",!1))},reviewPayload(){const t={user_name:this.$store.state.User.name,work_id:this.workid,rating:this.rating,review_text:this.reviewText,progress:this.progress};return t},submitReview(){const t={starOnly:!1},e=this.reviewPayload();this.$axios.put("/api/review",e,{params:t}).then(t=>{this.modified=!0,this.showSuccNotif(t.data.message)}).then(()=>this.closeDialog()).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},deleteReview(){const t={work_id:this.workid};this.$axios.delete("/api/review",{params:t}).then(t=>{this.modified=!0,this.showSuccNotif(t.data.message)}).then(()=>this.closeDialog()).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},We=ze,Ge=(a("49f7"),Object(h["a"])(We,je,Be,!1,null,"4c36ab3c",null)),Ke=Ge.exports;K()(Ge,"components",{QDialog:ht["a"],QCard:ut["a"],QCardSection:Gt["a"],QRating:qe["a"],QBtnToggle:Le["a"],QInput:Bt["a"],QCardActions:Lt["a"],QBtn:z["a"]}),K()(Ge,"directives",{ClosePopup:wt["a"]});var He={name:"WorkDetails",mixins:[it],components:{CoverSFW:fe,WriteReview:Ke},props:{metadata:{type:Object,required:!0}},data(){return{rating:0,userMarked:!1,progress:"",showReviewDialog:!1,showTags:!0}},computed:{sortedRatings:function(){function t(t,e){return t.review_point>e.review_point?-1:1}return this.metadata.rate_count_detail.slice().sort(t)}},watch:{metadata(t){t.userRating?(this.userMarked=!0,this.rating=t.userRating):(this.userMarked=!1,this.rating=t.rate_average_2dp||0),this.progress=t.progress,t.tags&&null===t.tags[0].name&&(this.showTags=!1)}},methods:{setProgress(t){this.progress=t;const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,progress:t};this.submitProgress(e)},submitProgress(t){const e={starOnly:!1,progressOnly:!0};this.$axios.put("/api/review",t,{params:e}).then(t=>{this.showSuccNotif(t.data.message),this.$emit("reset")}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},setRating(t){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:t};this.submitRating(e)},submitRating(t){this.$axios.put("/api/review",t).then(t=>{this.showSuccNotif(t.data.message),this.$emit("reset")}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},processReview(){this.showReviewDialog=!1}}},Ve=He,Ye=a("f20b"),Je=Object(h["a"])(Ve,De,Fe,!1,null,null,null),Xe=Je.exports;K()(Je,"components",{QRating:qe["a"],QTooltip:be["a"],QLinearProgress:ke["a"],QIcon:mt["a"],QChip:he["a"],QBtnDropdown:Ye["a"],QList:vt["a"],QItem:D["a"],QItemSection:F["a"],QAvatar:Kt["a"],QItemLabel:B["a"],QBtn:z["a"]});var Ze=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"q-ma-md "},[t.path.length?a("q-breadcrumbs",{attrs:{gutter:"xs"}},[a("q-breadcrumbs-el",[a("q-btn",{staticStyle:{height:"30px"},attrs:{"no-caps":"",flat:"",dense:"",size:"md",icon:"folder"},on:{click:function(e){t.path=[]}}},[t._v("ROOT")])],1),t._l(t.path,(function(e,s){return a("q-breadcrumbs-el",{key:s,staticClass:"cursor-pointer"},[a("q-btn",{staticStyle:{height:"30px"},attrs:{"no-caps":"",flat:"",dense:"",size:"md",icon:"folder"},on:{click:function(e){return t.onClickBreadcrumb(s)}}},[t._v(t._s(e))])],1)}))],2):t._e(),a("q-card",[a("q-list",{attrs:{separator:""}},t._l(t.fatherFolder,(function(e,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,staticClass:"non-selectable",attrs:{clickable:"",active:"audio"===e.type&&t.currentPlayingFile.hash===e.hash,"active-class":"text-white bg-teal"},on:{click:function(a){return t.onClickItem(e)}}},[a("q-item-section",{attrs:{avatar:""}},["folder"===e.type?a("q-icon",{attrs:{size:"34px",color:"amber",name:"folder"}}):"text"===e.type?a("q-icon",{attrs:{size:"34px",color:"info",name:"description"}}):"image"===e.type?a("q-icon",{attrs:{size:"34px",color:"orange",name:"photo"}}):"other"===e.type?a("q-icon",{attrs:{size:"34px",color:"info",name:"description"}}):a("q-btn",{attrs:{round:"",dense:"",color:"primary",icon:t.playIcon(e.hash)},on:{click:function(a){return t.onClickPlayButton(e.hash)}}})],1),a("q-item-section",[a("q-item-label",{attrs:{lines:"2"}},[t._v(t._s(e.title))]),e.children?a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.children.length+" 项目"))]):t._e()],1),"audio"===e.type||"text"===e.type||"image"===e.type||"other"===e.type?a("q-menu",{attrs:{"touch-position":"","context-menu":"","auto-close":"","transition-show":"jump-down","transition-hide":"jump-up"}},[a("q-list",{attrs:{separator:""}},["audio"===e.type?a("q-item",{attrs:{clickable:""},on:{click:function(a){return t.addToQueue(e)}}},[a("q-item-section",[t._v("添加到播放列表")])],1):t._e(),"audio"===e.type?a("q-item",{attrs:{clickable:""},on:{click:function(a){return t.playNext(e)}}},[a("q-item-section",[t._v("下一曲播放")])],1):t._e(),a("q-item",{attrs:{clickable:""},on:{click:function(a){return t.download(e)}}},[a("q-item-section",[t._v("下载文件")])],1)],1)],1):t._e()],1)})),1)],1)],1)},ta=[],ea={name:"WorkTree",data(){return{path:[]}},props:{tree:{type:Array,required:!0}},watch:{tree(){this.initPath()}},computed:{fatherFolder(){let t=this.tree.concat();return this.path.forEach(e=>{t=t.find(t=>"folder"===t.type&&t.title===e).children}),t},queue(){const t=[];return this.fatherFolder.forEach(e=>{"audio"===e.type&&t.push(e)}),t},...Object(v["d"])("AudioPlayer",["playing"]),...Object(v["b"])("AudioPlayer",["currentPlayingFile"])},methods:{playIcon(t){return this.playing&&this.currentPlayingFile.hash===t?"pause":"play_arrow"},initPath(){const t=[];let e=this.tree.concat();while(1===e.length){if("audio"===e[0].type)break;t.push(e[0].title),e=e[0].children}this.path=t},onClickBreadcrumb(t){this.path=this.path.slice(0,t+1)},onClickItem(t){"folder"===t.type?this.path.push(t.title):"text"===t.type||"image"===t.type?this.openFile(t):"other"===t.type?this.download(t):this.currentPlayingFile.hash!==t.hash&&this.$store.commit("AudioPlayer/SET_QUEUE",{queue:this.queue.concat(),index:this.queue.findIndex(e=>e.hash===t.hash),resetPlaying:!0})},onClickPlayButton(t){this.currentPlayingFile.hash===t?this.$store.commit("AudioPlayer/TOGGLE_PLAYING"):this.$store.commit("AudioPlayer/SET_QUEUE",{queue:this.queue.concat(),index:this.queue.findIndex(e=>e.hash===t),resetPlaying:!0})},addToQueue(t){this.$store.commit("AudioPlayer/ADD_TO_QUEUE",t)},playNext(t){this.$store.commit("AudioPlayer/PLAY_NEXT",t)},download(t){const e=this.$q.localStorage.getItem("jwt-token")||"",a=t.mediaDownloadUrl?`${t.mediaDownloadUrl}?token=${e}`:`/api/media/download/${t.hash}?token=${e}`,s=document.createElement("a");s.href=a,s.target="_blank",s.click()},openFile(t){const e=this.$q.localStorage.getItem("jwt-token")||"",a=t.mediaStreamUrl?`${t.mediaStreamUrl}?token=${e}`:`/api/media/stream/${t.hash}?token=${e}`,s=document.createElement("a");s.href=a,s.target="_blank",s.click()}}},aa=ea,sa=a("ead5"),ia=a("079e"),ra=Object(h["a"])(aa,Ze,ta,!1,null,null,null),oa=ra.exports;K()(ra,"components",{QBreadcrumbs:sa["a"],QBreadcrumbsEl:ia["a"],QBtn:z["a"],QCard:ut["a"],QList:vt["a"],QItem:D["a"],QItemSection:F["a"],QIcon:mt["a"],QItemLabel:B["a"],QMenu:pt["a"]}),K()(ra,"directives",{Ripple:W["a"]});var na={name:"Work",mixins:[it],components:{WorkDetails:Xe,WorkTree:oa},data(){return{workid:this.$route.params.id,metadata:{id:parseInt(this.$route.params.id),circle:{}},tree:[]}},watch:{$route(t){this.workid=t.params.id,this.requestData()}},created(){this.requestData()},methods:{requestData(){this.$axios.get("/api/work/"+this.workid).then(t=>{this.metadata=t.data}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)}),this.$axios.get("/api/tracks/"+this.workid).then(t=>{this.tree=t.data}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},la=na,ca=Object(h["a"])(la,Ae,Ue,!1,null,null,null),da=ca.exports,ua=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"text-h5 text-weight-regular q-ma-md"},[t._v("\n    All "+t._s(t.restrict)+"s\n  ")]),a("div",{staticClass:"row justify-center q-pb-xl q-pt-none"},[a("div",{staticClass:"col-11"},[a("q-input",{staticClass:"q-mb-md",attrs:{dense:"",rounded:"",outlined:"",placeholder:"Search for a "+t.restrict+"..."},scopedSlots:t._u([{key:"append",fn:function(){return[""===t.keyword?a("q-icon",{attrs:{name:"search"}}):a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(e){t.keyword=""}}})]},proxy:!0}]),model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),a("div",{staticClass:"row justify-center q-gutter-sm"},t._l(t.keyword?t.filteredItems:t.items,(function(e){return a("div",{key:e.id,staticClass:"col-auto"},[a("q-btn",{attrs:{"no-caps":"",rounded:"",color:"primary",label:e.name+" ("+e.count+")",to:"/works?"+t.queryField+"="+e.id}})],1)})),0)],1)])])},pa=[],ma={name:"List",mixins:[it],props:{restrict:{type:String}},data(){return{items:[],keyword:""}},created(){this.requestList()},computed:{url(){return`/api/${this.restrict}/`},queryField(){switch(this.restrict){case"circles":return"circleId";case"tags":return"tagId";case"vas":return"vaId";default:return"circleId"}},filteredItems(){return this.items.filter(t=>-1!==t.name.toLowerCase().indexOf(this.keyword.toLowerCase()))}},watch:{url(){this.requestList()}},methods:{requestList(){this.$axios.get(this.url).then(t=>{this.items=t.data.concat()}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},ha=ma,ga=Object(h["a"])(ha,ua,pa,!1,null,null,null),fa=ga.exports;K()(ga,"components",{QInput:Bt["a"],QIcon:mt["a"],QBtn:z["a"]});var va=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-form",{staticClass:"absolute-center\tq-gutter-md",staticStyle:{width:"260px"},on:{submit:t.onSubmit}},[a("q-input",{staticClass:"fit",attrs:{filled:"",label:"用户名","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"}]},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("q-input",{staticClass:"fit",attrs:{filled:"",type:"password",label:"密码","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"}]},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),a("q-btn",{staticClass:"fit",attrs:{label:"登录",type:"submit",color:"primary"}})],1)},wa=[],qa=a("bc3a"),ba=a.n(qa);function ka(t){ba.a.defaults.headers["Authorization"]="Bearer "+t}ba.a.defaults.headers["Content-Type"]="application/json",ba.a.defaults.headers["Authorization"]=n["a"].getItem("jwt-token")?"Bearer "+n["a"].getItem("jwt-token"):"",s["default"].prototype.$axios=ba.a;var ya={mixins:[it],data(){return{name:"",password:""}},methods:{onSubmit(){this.$axios.post("/api/auth/me",{name:this.name,password:this.password}).then(t=>{try{this.$q.localStorage.set("jwt-token",t.data.token),ka(t.data.token),this.showSuccNotif("登录成功."),this.$router.push("/")}catch(e){this.showErrNotif(e.message)}}).catch(t=>{t.response?401===t.response.status?this.showWarnNotif(t.response.data.error):this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},_a=ya,xa=a("0378"),Sa=Object(h["a"])(_a,va,wa,!1,null,null,null),Ca=Sa.exports;K()(Sa,"components",{QForm:xa["a"],QInput:Bt["a"],QBtn:z["a"]});var Ta=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("div",{staticClass:"fit row wrap justify-between items-start q-px-sm"},[a("div",{staticClass:"col-lg-3 col-sm-12 col-xs-12"},[a("q-btn-toggle",{staticClass:"text-bold",attrs:{spread:"","no-caps":"",rounded:"","toggle-color":"primary",color:"white","text-color":"black",options:[{label:"我的评价",value:"review"},{label:"我的进度",value:"progress"},{label:"分类整理",value:"folder"}]},on:{input:t.changeMode},model:{value:t.mode,callback:function(e){t.mode=e},expression:"mode"}})],1),a("div",{staticClass:"col-auto gt-sm row"},[a("q-select",{staticClass:"q-mx-sm",attrs:{dense:"",rounded:"",outlined:"",options:t.sortOptions,"bg-color":"white"},model:{value:t.sortBy,callback:function(e){t.sortBy=e},expression:"sortBy"}}),a("q-btn",{attrs:{disable:t.sortButtonDisabled,dense:"",rounded:"",color:"white","text-color":t.sortButtonDisabled?"grey":"black",icon:t.direction?"arrow_downward":"arrow_upward"},on:{click:t.switchSortMode}})],1)]),a("div",{staticClass:"q-pt-md q-px-sm"},["progress"===t.mode?a("q-btn-toggle",{attrs:{"toggle-color":"primary",color:"white","text-color":"black",rounded:"",options:[{label:"想听",value:"marked"},{label:"在听",value:"listening"},{label:"听过",value:"listened"},{label:"重听",value:"replay"},{label:"搁置",value:"postponed"}]},on:{input:t.changeProgressFilter},model:{value:t.progressFilter,callback:function(e){t.progressFilter=e},expression:"progressFilter"}}):t._e()],1),a("div",{staticClass:"q-pt-md"},[a("div",{staticClass:"q-px-sm q-py-md"},["folder"!==t.mode?a("q-infinite-scroll",{ref:"scroll",attrs:{offset:500,disable:t.stopLoad},on:{load:t.onLoad},scopedSlots:t._u([{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}],null,!1,3159847669)},[0===t.works.length?a("div",{staticClass:"row justify-center text-grey"},[t._v("在作品界面上点击星标、标记进度，标记的音声就会出现在这里啦")]):t._e(),t.works.length?a("q-list",{staticClass:"shadow-2",attrs:{bordered:"",separator:""}},t._l(t.works,(function(e){return a("FavListItem",{key:e.id,attrs:{workid:e.id,metadata:e,mode:t.mode},on:{reset:function(e){return t.reset()}}})})),1):t._e()],1):a("div",{staticClass:"row justify-center text-grey"},[t._v("尚未实现，敬请期待")])],1)])])},Ea=[],$a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-item",{staticClass:"row bg-white",attrs:{clickable:""}},[a("q-item-section",{staticClass:"col-auto",attrs:{top:""}},[a("router-link",{attrs:{to:"/work/"+t.metadata.id}},[a("q-img",{staticStyle:{height:"120px",width:"160px"},attrs:{transition:"fade",src:t.coverUrl}})],1)],1),a("q-item-section",{staticClass:"q-gutter-y-xs column items-start",attrs:{top:""},on:{click:function(e){if(e.target!==e.currentTarget)return null;t.showReviewDialog=!0}}},[a("q-item-label",{staticClass:"text-body2",attrs:{lines:"2"}},[a("router-link",{staticClass:"col-auto text-black",attrs:{to:"/work/"+t.metadata.id}},[t._v("\n          "+t._s(t.metadata.title)+"\n        ")])],1),a("div",{staticClass:"row q-gutter-x-sm col-auto"},[a("router-link",{staticClass:"col-auto text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n          "+t._s(t.metadata.circle.name)+"\n        ")]),a("span",{staticClass:"col-auto"},[t._v("/")]),a("span",{staticClass:"col-auto text-grey"},[t._v(" "+t._s(t.metadata.release))]),a("span",{staticClass:"col-auto"},[t._v("/")]),t._l(t.metadata.vas,(function(e,s){return a("router-link",{key:s,staticClass:"col-auto text-primary",attrs:{to:"/works?vaId="+e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])}))],2),a("div",{staticClass:"row items-center q-gutter-x-xs"},[t.hideRating?t._e():a("q-rating",{staticClass:"col-auto",attrs:{size:"sm",color:"blue",icon:"star_border","icon-selected":"star","icon-half":"star_half"},on:{input:t.setRating},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),a("span",{staticClass:"col-auto text-grey "},[t._v(t._s(t.metadata.updated_at))])],1),"review"===t.mode?a("q-item-label",{staticClass:"q-pt-sm"},[a("q-card",{directives:[{name:"show",rawName:"v-show",value:t.metadata.review_text,expression:"metadata.review_text"}],staticClass:"my-card col-auto",on:{click:function(e){t.showReviewDialog=!0}}},[a("q-card-section",{staticClass:"q-pa-sm"},[a("pre",{staticClass:"q-ma-none"},[t._v(t._s(t.metadata.review_text))])])],1)],1):t._e(),"progress"===t.mode?a("q-item-label",{staticClass:"q-pt-xs"},["progress"===t.mode?a("q-btn-toggle",{staticClass:"q-pa-sm",attrs:{dense:"","no-caps":"",rounded:"","toggle-color":"primary",color:"white","text-color":"black",options:[{label:"想听",value:"marked"},{label:"在听",value:"listening"},{label:"听过",value:"listened"},{label:"重听",value:"replay"},{label:"搁置",value:"postponed"}]},on:{input:t.setProgress},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}}):t._e()],1):t._e()],1),t.showReviewDialog?a("WriteReview",{attrs:{workid:t.workid,metadata:t.metadata},on:{closed:t.processReview}}):t._e()],1)},Ia=[],Pa={name:"FavListItem",mixins:[it],components:{WriteReview:Ke},props:{workid:{type:Number,required:!0},metadata:{type:Object,required:!0},mode:{type:String,default:"review"}},data(){return{rating:0,showReviewDialog:!1,hideRating:!1,progress:""}},computed:{coverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"";return this.workid?`/api/cover/${this.workid}?type=240x240&token=${t}`:""}},mounted(){this.setMetadata()},watch:{metadata(){this.setMetadata()}},methods:{setMetadata(){this.metadata.userRating?this.rating=this.metadata.userRating:this.hideRating=!0,this.rating?this.hideRating=!1:this.hideRating=!0,this.progress=this.metadata.progress},processReview(t){t&&(this.calledFromChild=!0,this.$emit("reset")),this.showReviewDialog=!1},setRating(t){if(t){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:t};this.submitRating(e)}},submitRating(t){const e={starOnly:!0};this.$axios.put("/api/review",t,{params:e}).then(t=>{this.showSuccNotif(t.data.message)}).then(()=>this.$emit("reset")).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},setProgress(t){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,progress:t};this.submitProgress(e)},submitProgress(t){const e={starOnly:!1,progressOnly:!0};this.$axios.put("/api/review",t,{params:e}).then(t=>{this.showSuccNotif(t.data.message)}).then(()=>this.$emit("reset")).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},Qa=Pa,Na=Object(h["a"])(Qa,$a,Ia,!1,null,null,null),La=Na.exports;K()(Na,"components",{QItem:D["a"],QItemSection:F["a"],QImg:j["a"],QItemLabel:B["a"],QRating:qe["a"],QCard:ut["a"],QCardSection:Gt["a"],QBtnToggle:Le["a"]});var Ra={name:"Favourites",mixins:[it],components:{FavListItem:La},props:{route:{type:String,default:"review"},progress:{type:String,default:"marked"}},computed:{direction(){return"desc"===this.sortMode},sortButtonDisabled(){return"allage"===this.sortBy.order||"nsfw"===this.sortBy.order}},data(){return{mode:"review",progressFilter:"marked",works:[],stopLoad:!1,pagination:{currentPage:0,pageSize:12,totalCount:0},sortMode:"desc",sortBy:{label:"标记时间",order:"updated_at"},sortOptions:[{label:"标记时间",order:"updated_at"},{label:"评价",order:"userRating"},{label:"发布时间",order:"release"},{label:"评论数量",order:"review_count"},{label:"售出数量",order:"dl_count"},{label:"全年龄新作",order:"allage"},{label:"18禁新作",order:"nsfw"}]}},created(){this.mode=this.route,this.progressFilter=this.progress},mounted(){if(localStorage.sortByFavourites)try{this.sortBy=JSON.parse(localStorage.sortByFavourites)}catch{localStorage.removeItem("sortByFavourites")}},watch:{sortBy(t){localStorage.sortByFavourites=JSON.stringify(t),this.reset()},sortMode(){this.reset()},route(){this.mode=this.route,this.reset()},progress(){this.progressFilter=this.progress,this.reset()}},methods:{changeMode(t){this.$router.push("/favourites/"+t),this.reset()},changeProgressFilter(t){this.$router.push("/favourites/progress/"+t),this.reset()},switchSortMode(){"desc"===this.sortMode?this.sortMode="asc":this.sortMode="desc"},onLoad(t,e){this.requestWorksQueue().then(()=>e())},reset(){this.stopLoad=!0,this.pagination={currentPage:0,pageSize:12,totalCount:0},this.requestWorksQueue().then(()=>{this.stopLoad=!1})},requestWorksQueue(){const t={order:this.sortBy.order,sort:this.sortMode,page:this.pagination.currentPage+1||1};return"allage"===this.sortBy.order&&(t.order="nsfw",t.sort="asc"),"nsfw"===this.sortBy.order&&(t.order="nsfw",t.sort="desc"),"progress"===this.mode&&(t.filter=this.progressFilter),this.$axios.get("/api/review",{params:t}).then(e=>{const a=e.data.works;this.works=1===t.page?a.concat():this.works.concat(a),this.pagination=e.data.pagination,this.works.length>=this.pagination.totalCount&&(this.stopLoad=!0)}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t),this.stopLoad=!0})}}},Ma=Ra,Oa=Object(h["a"])(Ma,Ta,Ea,!1,null,null,null),Aa=Oa.exports;K()(Oa,"components",{QPage:Vt["a"],QBtnToggle:Le["a"],QSelect:Ne["a"],QBtn:z["a"],QInfiniteScroll:Qe["a"],QList:vt["a"],QSpinnerDots:Re["a"]});var Ua=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("q-card",{staticClass:"q-ma-md"},[a("q-form",{on:{submit:t.onSubmitRootFolder}},[a("q-toolbar",[a("q-toolbar-title",[t._v("添加新文件夹")])],1),a("div",{staticClass:"q-pa-sm"},[a("q-input",{attrs:{outlined:"",dense:"",required:"","lazy-rules":"",rules:[function(e){return!t.config.rootFolders.find((function(t){return t.name===e}))||"该别名已存在，文件夹别名不能重复"}],label:"文件夹别名"},model:{value:t.rootFolder.name,callback:function(e){t.$set(t.rootFolder,"name",e)},expression:"rootFolder.name"}}),a("q-input",{attrs:{outlined:"",dense:"",required:"","lazy-rules":"",rules:[function(e){return!t.config.rootFolders.find((function(t){return t.path===e}))||"该路径已存在，文件夹路径不能重复"}],label:"绝对路径"},model:{value:t.rootFolder.path,callback:function(e){t.$set(t.rootFolder,"path",e)},expression:"rootFolder.path"}}),a("div",{staticClass:"row justify-end"},[a("q-btn",{attrs:{type:"submit",color:"primary",label:"添加"}})],1)],1)],1)],1),a("q-form",{on:{submit:t.onSubmit}},[a("q-card",{directives:[{name:"show",rawName:"v-show",value:t.config.rootFolders.length,expression:"config.rootFolders.length"}],staticClass:"q-ma-md"},[a("q-toolbar",[a("q-toolbar-title",[t._v("文件夹列表")])],1),a("q-list",t._l(t.config.rootFolders,(function(e){return a("q-item",{key:e.name},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{color:"amber",name:"folder"}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(e.name))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.path))])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-btn",{attrs:{flat:"",round:"",color:"red",icon:"delete"},on:{click:function(e){return t.removeFromRootFolders(t.index)}}})],1)],1)})),1)],1),a("q-card",{staticClass:"q-ma-md"},[a("q-toolbar",[a("q-toolbar-title",[t._v("封面文件夹路径")])],1),t.config.coverUseDefaultPath?a("div",{staticClass:"q-pa-md"},[t._v("已指定为默认路径，即程序所在位置下的covers文件夹。如需修改，请前往高级设置并取消“封面使用默认路径”。")]):a("q-input",{staticClass:"q-pa-sm",attrs:{outlined:"",dense:"",required:""},model:{value:t.config.coverFolderDir,callback:function(e){t.$set(t.config,"coverFolderDir",e)},expression:"config.coverFolderDir"}})],1),a("div",{staticClass:"q-ma-lg row justify-end"},[a("q-btn",{attrs:{loading:t.loading,label:"保存",type:"submit",color:"primary"}})],1)],1)],1)},Da=[],Fa={name:"Folders",mixins:[it],data(){return{config:{rootFolders:[]},rootFolder:{name:"",path:""},loading:!1}},methods:{requestConfig(){this.$axios.get("/api/config/admin").then(t=>{this.config=t.data.config,this.rootFolder.path=t.data.config.voiceWorkDefaultPath}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},onSubmit(){this.loading=!0,this.$axios.put("/api/config/admin",{config:this.config}).then(t=>{this.showSuccNotif(t.data.message),this.loading=!1}).catch(t=>{this.loading=!1,t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},onSubmitRootFolder(){""!==this.rootFolder.name&&""!==this.rootFolder.path&&(this.config.rootFolders.push({name:this.rootFolder.name,path:this.rootFolder.path}),this.rootFolder.name="",this.rootFolder.path="",this.onSubmit())},removeFromRootFolders(t){this.config.rootFolders.splice(t,1),this.onSubmit()}},created(){this.requestConfig()}},ja=Fa,Ba=Object(h["a"])(ja,Ua,Da,!1,null,null,null),za=Ba.exports;K()(Ba,"components",{QCard:ut["a"],QForm:xa["a"],QToolbar:Ft["a"],QToolbarTitle:jt["a"],QInput:Bt["a"],QBtn:z["a"],QList:vt["a"],QItem:D["a"],QItemSection:F["a"],QIcon:mt["a"],QItemLabel:B["a"]});var Wa=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"row q-ma-sm"},[a("div",{staticClass:"col-xs-6 col-sm-4 row q-pa-sm"},[a("q-btn",{staticClass:"col",attrs:{color:"teal",label:"扫描本地音声库",disable:"running"===t.state||!(t.loggedIn||t.$socket.connected)},on:{click:function(e){return t.performScan()}}})],1),a("div",{staticClass:"col-xs-6 col-sm-4 row q-pa-sm"},[a("q-btn",{staticClass:"col",attrs:{color:"primary",label:"刷新音声库信息",disable:"running"===t.state||!(t.loggedIn||t.$socket.connected)},on:{click:function(e){return t.performUpdate()}}})],1),a("div",{staticClass:"col-xs-12 col-sm-4 row q-pa-sm"},[a("q-btn",{staticClass:"col",attrs:{color:"negative",label:"终止扫描进程",disable:"running"!==t.state||!(t.loggedIn||t.$socket.connected)},on:{click:function(e){return t.killScanProceess()}}})],1)]),a("q-card",{directives:[{name:"show",rawName:"v-show",value:t.state,expression:"state"}],staticClass:"q-ma-md"},[a("q-expansion-item",{attrs:{"expand-separator":""},scopedSlots:t._u([{key:"header",fn:function(){return[a("q-item-section",{attrs:{avatar:""}},["running"===t.state?a("q-spinner-gears",{attrs:{color:"primary",size:"2em"}}):"finished"===t.state?a("q-icon",{attrs:{name:"done",color:"positive",size:"2em"}}):"error"===t.state?a("q-icon",{attrs:{name:"bug_report",color:"red",size:"2em"}}):t._e()],1),a("q-item-section",[t.allLogs.length>1?a("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(t.allLogs[t.allLogs.length-2].message))]):t._e(),t.allLogs.length>0?a("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(t.allLogs[t.allLogs.length-1].message))]):t._e()],1)]},proxy:!0}])},[a("q-scroll-area",{staticClass:"bg-dark text-white q-pa-md",staticStyle:{height:"256px"}},t._l(t.allLogs,(function(e,s){return a("div",{key:s},[a("span",{class:"error"===e.level?"text-red":""},[t._v("➜ "+t._s(e.message))])])})),0)],1)],1),a("q-card",{directives:[{name:"show",rawName:"v-show",value:t.tasks.length>0||t.failedTasks.length>0,expression:"(tasks.length > 0) || (failedTasks.length > 0)"}],staticClass:"q-ma-md"},[a("q-tabs",{staticClass:"text-grey",attrs:{dense:"","inline-label":"","active-color":"white","active-bg-color":"brown","indicator-color":"yellow",align:"justify","narrow-indicator":""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[a("q-tab",{attrs:{name:"tasks",icon:"hourglass_full",label:"处理中"}},[a("q-badge",{directives:[{name:"show",rawName:"v-show",value:t.tasks.length>0,expression:"tasks.length > 0"}],attrs:{color:"primary",floating:""}},[t._v(t._s(t.tasks.length))])],1),a("q-tab",{attrs:{name:"failedTasks",icon:"error_outline",label:"处理失败"}},[a("q-badge",{directives:[{name:"show",rawName:"v-show",value:t.failedTasks.length>0,expression:"failedTasks.length > 0"}],attrs:{color:"red",floating:""}},[t._v(t._s(t.failedTasks.length))])],1)],1),a("q-separator"),a("q-tab-panels",{attrs:{animated:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[a("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"tasks"}},[a("q-virtual-scroll",{staticStyle:{"max-height":"313px"},attrs:{separator:"",items:t.tasks,"virtual-scroll-item-size":52},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.item,i=e.index;return[a("q-expansion-item",{key:i,attrs:{"expand-separator":""},scopedSlots:t._u([{key:"header",fn:function(){return[a("q-item-section",{attrs:{avatar:""}},[a("q-spinner-hourglass",{attrs:{color:"primary",size:"2em"}})],1),a("q-item-section",[s.logs.length>0?a("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(s.logs[s.logs.length-1].message))]):t._e(),a("q-item-label",{attrs:{caption:""}},[t._v(t._s("RJ"+s.rjcode))])],1)]},proxy:!0}],null,!0)},[a("q-card",[a("q-card-section",{staticClass:"bg-dark text-white"},t._l(s.logs,(function(e,s){return a("div",{key:s},[a("span",{class:"error"===e.level?"text-red":""},[t._v("➜ "+t._s(e.message))])])})),0)],1)],1)]}}])})],1),a("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"failedTasks"}},[a("q-virtual-scroll",{staticStyle:{"max-height":"313px"},attrs:{separator:"",items:t.failedTasks,"virtual-scroll-item-size":52},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.item,i=e.index;return[a("q-expansion-item",{key:i,attrs:{"expand-separator":"","expand-icon-class":"text-white","header-class":"bg-negative"},scopedSlots:t._u([{key:"header",fn:function(){return[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"bug_report",color:"white",size:"2em"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-white ellipsis"},[t._v("\n                    "+t._s(s.logs[s.logs.length-1].message)+"\n                  ")]),a("q-item-label",{staticClass:"text-white",attrs:{caption:""}},[t._v("\n                    "+t._s("RJ"+s.rjcode)+"\n                  ")])],1)]},proxy:!0}],null,!0)},[a("q-card",[a("q-card-section",{staticClass:"bg-dark text-white"},t._l(s.logs,(function(e,s){return a("div",{key:s},[a("span",{class:"error"===e.level?"text-red":""},[t._v("➜ "+t._s(e.message))])])})),0)],1)],1)]}}])})],1)],1)],1)],1)},Ga=[],Ka={name:"Scanner",mixins:[it],data(){return{tab:"tasks",state:null,loggedIn:!1,tasks:[],failedTasks:[],mainLogs:[],results:[]}},sockets:{SCAN_TASKS(t){this.tasks=t.tasks},SCAN_FAILED_TASKS(t){this.failedTasks=t.failedTasks},SCAN_MAIN_LOGS(t){this.mainLogs=t.mainLogs},SCAN_RESULTS(t){this.results=t.results},SCAN_INIT_STATE(t){this.state="running",this.tasks=t.tasks,this.failedTasks=t.failedTasks,this.mainLogs=t.mainLogs,this.results=t.results},SCAN_FINISHED(t){this.state="finished",this.allLogs.push({level:"info",message:t.message})},SCAN_ERROR(){this.state="error"},success(){this.loggedIn=!0}},methods:{performScan(){this.tasks=[],this.failedTasks=[],this.mainLogs=[],this.results=[],this.state="running",this.$socket.emit("PERFORM_SCAN")},performUpdate(){this.tasks=[],this.failedTasks=[],this.mainLogs=[],this.results=[],this.state="running",this.$socket.emit("PERFORM_UPDATE")},killScanProceess(){this.$socket.emit("KILL_SCAN_PROCESS")}},computed:{allLogs(){const t=this.results.map(t=>"added"===t.result?{level:"info",message:`[RJ${t.rjcode}] 添加成功! Added: ${t.count}`}:"updated"===t.result?{level:"info",message:`[RJ${t.rjcode}] 更新成功! Updated: ${t.count}`}:{level:"error",message:`[RJ${t.rjcode}] 处理失败! Failed: ${t.count}`});return this.mainLogs.concat(t)}},mounted(){this.$socket.emit("ON_SCANNER_PAGE"),this.$socket.on("connect_error",()=>{this.showErrNotif("连接Socket失败")})}},Ha=Ka,Va=a("3b73"),Ya=a("cf57"),Ja=a("429b"),Xa=a("7460"),Za=a("58a8"),ts=a("adad"),es=a("823b"),as=a("a12b"),ss=a("9149"),is=Object(h["a"])(Ha,Wa,Ga,!1,null,null,null),rs=is.exports;K()(is,"components",{QBtn:z["a"],QCard:ut["a"],QExpansionItem:Va["a"],QItemSection:F["a"],QSpinnerGears:Ya["a"],QIcon:mt["a"],QItemLabel:B["a"],QScrollArea:Wt["a"],QTabs:Ja["a"],QTab:Xa["a"],QBadge:Za["a"],QSeparator:ft["a"],QTabPanels:ts["a"],QTabPanel:es["a"],QVirtualScroll:as["a"],QSpinnerHourglass:ss["a"],QCardSection:Gt["a"]});var os=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-form",{on:{submit:t.onSubmit}},[a("q-card",{staticClass:"q-ma-md"},[a("q-toolbar",[a("q-toolbar-title",[t._v("播放器设置")])],1),a("q-list",[a("q-item",{staticStyle:{height:"70px"}},[a("q-item-section",[a("q-item-label",[t._v("后退按钮跳跃秒数")]),a("q-item-label",{attrs:{caption:""}},[t._v("播放时后退按钮跳跃秒数")])],1),a("q-item-section",{attrs:{avatar:""}},[a("div",{staticClass:"q-gutter-sm"},[a("q-radio",{attrs:{dense:"",val:"5",label:"5 秒"},model:{value:t.rewindSeekTime,callback:function(e){t.rewindSeekTime=e},expression:"rewindSeekTime"}}),a("q-radio",{attrs:{dense:"",val:"10",label:"10 秒"},model:{value:t.rewindSeekTime,callback:function(e){t.rewindSeekTime=e},expression:"rewindSeekTime"}}),a("q-radio",{attrs:{dense:"",val:"30",label:"30 秒"},model:{value:t.rewindSeekTime,callback:function(e){t.rewindSeekTime=e},expression:"rewindSeekTime"}})],1)])],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("前进按钮跳跃秒数")]),a("q-item-label",{attrs:{caption:""}},[t._v("播放时前进按钮跳跃秒数")])],1),a("q-item-section",{attrs:{avatar:""}},[a("div",{staticClass:"q-gutter-sm"},[a("q-radio",{attrs:{dense:"",val:"5",label:"5 秒"},model:{value:t.forwardSeekTime,callback:function(e){t.forwardSeekTime=e},expression:"forwardSeekTime"}}),a("q-radio",{attrs:{dense:"",val:"10",label:"10 秒"},model:{value:t.forwardSeekTime,callback:function(e){t.forwardSeekTime=e},expression:"forwardSeekTime"}}),a("q-radio",{attrs:{dense:"",val:"30",label:"30 秒"},model:{value:t.forwardSeekTime,callback:function(e){t.forwardSeekTime=e},expression:"forwardSeekTime"}})],1)])],1)],1)],1),a("q-card",{staticClass:"q-ma-md"},[a("q-toolbar",[a("q-toolbar-title",[t._v("爬虫相关设置")])],1),a("q-list",[a("q-item",{staticStyle:{height:"70px"}},[a("q-item-section",[a("q-item-label",[t._v("标签语言")]),a("q-item-label",{attrs:{caption:""}},[t._v("从 DLSite 爬取的标签元数据的语言")])],1),a("q-item-section",{attrs:{avatar:""}},[a("div",{staticClass:"q-gutter-sm"},[a("q-radio",{attrs:{dense:"",val:"zh-cn",label:"简"},model:{value:t.config.tagLanguage,callback:function(e){t.$set(t.config,"tagLanguage",e)},expression:"config.tagLanguage"}}),a("q-radio",{attrs:{dense:"",val:"zh-tw",label:"繁"},model:{value:t.config.tagLanguage,callback:function(e){t.$set(t.config,"tagLanguage",e)},expression:"config.tagLanguage"}}),a("q-radio",{attrs:{dense:"",val:"ja-jp",label:"日"},model:{value:t.config.tagLanguage,callback:function(e){t.$set(t.config,"tagLanguage",e)},expression:"config.tagLanguage"}})],1)])],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("DLsite 超时时间")]),a("q-item-label",{attrs:{caption:""}},[t._v("默认 10000 毫秒")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.dlsiteTimeout,callback:function(e){t.$set(t.config,"dlsiteTimeout",t._n(e))},expression:"config.dlsiteTimeout"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("HVDB 超时时间")]),a("q-item-label",{attrs:{caption:""}},[t._v("默认 10000 毫秒")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.hvdbTimeout,callback:function(e){t.$set(t.config,"hvdbTimeout",t._n(e))},expression:"config.hvdbTimeout"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("重新请求间隔时间")]),a("q-item-label",{attrs:{caption:""}},[t._v("默认 2000 毫秒")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.retryDelay,callback:function(e){t.$set(t.config,"retryDelay",t._n(e))},expression:"config.retryDelay"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("请求最大尝试次数")]),a("q-item-label",{attrs:{caption:""}},[t._v("默认 5")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.retry,callback:function(e){t.$set(t.config,"retry",t._n(e))},expression:"config.retry"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("爬虫并行任务数量")]),a("q-item-label",{attrs:{caption:""}},[t._v("默认 16")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.maxParallelism,callback:function(e){t.$set(t.config,"maxParallelism",t._n(e))},expression:"config.maxParallelism"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("HTTP 代理服务主机 IP")]),a("q-item-label",{attrs:{caption:""}},[t._v("此项为空时默认为本机")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{"input-class":"text-right"},model:{value:t.config.httpProxyHost,callback:function(e){t.$set(t.config,"httpProxyHost",e)},expression:"config.httpProxyHost"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("HTTP 代理服务端口号 ")]),a("q-item-label",{attrs:{caption:""}},[t._v("此项为 0 时默认不使用代理")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.httpProxyPort,callback:function(e){t.$set(t.config,"httpProxyPort",t._n(e))},expression:"config.httpProxyPort"}})],1)],1)],1)],1),a("q-card",{staticClass:"q-ma-md"},[a("q-toolbar",[a("q-toolbar-title",[t._v("文件夹扫描相关设置")])],1),a("q-list",[a("q-item",{staticStyle:{height:"70px"}},[a("q-item-section",[a("q-item-label",[t._v("最大递归扫描深度")]),a("q-item-label",{attrs:{caption:""}},[t._v("默认 2")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.scannerMaxRecursionDepth,callback:function(e){t.$set(t.config,"scannerMaxRecursionDepth",t._n(e))},expression:"config.scannerMaxRecursionDepth"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("扫描时跳过清理音声库")]),a("q-item-label",{attrs:{caption:""}},[t._v("是否跳过清理不存在的音声（不推荐，默认不跳过）")])],1),a("q-item-section",{attrs:{side:""}},[a("q-toggle",{attrs:{dense:""},model:{value:t.config.skipCleanup,callback:function(e){t.$set(t.config,"skipCleanup",e)},expression:"config.skipCleanup"}})],1)],1)],1)],1),a("q-card",{staticClass:"q-ma-md"},[a("q-toolbar",[a("q-toolbar-title",[t._v("Web 服务器相关设置")]),a("div",{staticClass:"q-pr-xs"},[t._v("更改此设置需要重启程序")])],1),a("q-list",[a("q-item",{staticStyle:{height:"70px"}},[a("q-item-section",[a("q-item-label",[t._v("用户验证")]),a("q-item-label",{attrs:{caption:""}},[t._v("是否启用用户验证（生产环境下无法修改此设置）")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-toggle",{attrs:{dense:"",disable:t.config.production},model:{value:t.config.auth,callback:function(e){t.$set(t.config,"auth",e)},expression:"config.auth"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("启用Gzip")]),a("q-item-label",{attrs:{caption:""}},[t._v("对网络传输启用Gzip压缩")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-toggle",{attrs:{dense:""},model:{value:t.config.enableGzip,callback:function(e){t.$set(t.config,"enableGzip",e)},expression:"config.enableGzip"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("设置端口号")]),a("q-item-label",{attrs:{caption:""}},[t._v("服务器监听端口号")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.listenPort,callback:function(e){t.$set(t.config,"listenPort",t._n(e))},expression:"config.listenPort"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("屏蔽远程连接")]),a("q-item-label",{attrs:{caption:""}},[t._v("只允许本地访问，默认为false。更改此设置需要重启程序")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-toggle",{attrs:{dense:""},model:{value:t.config.blockRemoteConnection,callback:function(e){t.$set(t.config,"blockRemoteConnection",e)},expression:"config.blockRemoteConnection"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("token 过期时间")]),a("q-item-label",{attrs:{caption:""}},[t._v("默认 2592000 秒")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.expiresIn,callback:function(e){t.$set(t.config,"expiresIn",t._n(e))},expression:"config.expiresIn"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("每页显示的音声数量")]),a("q-item-label",{attrs:{caption:""}},[t._v("默认 12")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.pageSize,callback:function(e){t.$set(t.config,"pageSize",t._n(e))},expression:"config.pageSize"}})],1)],1)],1)],1),a("q-card",{staticClass:"q-ma-md"},[a("q-toolbar",[a("q-toolbar-title",[t._v("安全设置")])],1),a("q-list",[a("q-item",{staticStyle:{height:"70px"}},[a("q-item-section",[a("q-item-label",[t._v("生产环境")]),a("q-item-label",{attrs:{caption:""}},[t._v("此设置无法在网页端修改，详情请查阅GitHub Wiki中关于配置文件的说明")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-toggle",{attrs:{dense:"",disable:""},model:{value:t.config.production,callback:function(e){t.$set(t.config,"production",e)},expression:"config.production"}})],1)],1)],1)],1),a("q-card",{staticClass:"q-ma-md"},[a("q-toolbar",[a("q-toolbar-title",[t._v("其它设置")])],1),a("q-list",[a("q-item",{staticStyle:{height:"70px"}},[a("q-item-section",[a("q-item-label",[t._v("检查更新")]),a("q-item-label",{attrs:{caption:""}},[t._v("打开网页时是否检查更新")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-toggle",{attrs:{dense:""},model:{value:t.config.checkUpdate,callback:function(e){t.$set(t.config,"checkUpdate",e)},expression:"config.checkUpdate"}})],1)],1),t.config.checkUpdate?a("q-item",[a("q-item-section",[a("q-item-label",[t._v("检查测试版更新")]),a("q-item-label",{attrs:{caption:""}},[t._v("是否检查测试版更新")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-toggle",{attrs:{dense:""},model:{value:t.config.checkBetaUpdate,callback:function(e){t.$set(t.config,"checkBetaUpdate",e)},expression:"config.checkBetaUpdate"}})],1)],1):t._e(),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("数据库使用默认路径")]),a("q-item-label",{attrs:{caption:""}},[t._v("使用程序所在位置下的sqlite文件夹，并忽略databaseFolderDir设置（如无必要请勿修改，更改此设置需要重启程序）")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-toggle",{attrs:{dense:""},model:{value:t.config.dbUseDefaultPath,callback:function(e){t.$set(t.config,"dbUseDefaultPath",e)},expression:"config.dbUseDefaultPath"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[t._v("封面使用默认路径")]),a("q-item-label",{attrs:{caption:""}},[t._v("使用程序所在位置下的covers文件夹，并忽略封面文件夹路径设置")])],1),a("q-item-section",{attrs:{avatar:""}},[a("q-toggle",{attrs:{dense:""},model:{value:t.config.coverUseDefaultPath,callback:function(e){t.$set(t.config,"coverUseDefaultPath",e)},expression:"config.coverUseDefaultPath"}})],1)],1)],1)],1),a("div",{staticClass:"q-ma-lg row justify-end"},[a("q-btn",{attrs:{loading:t.loading,label:"保存",type:"submit",color:"primary"}})],1)],1)},ns=[],ls={name:"Advanced",mixins:[it],data(){return{config:{},loading:!1,rewindSeekTime:"5",forwardSeekTime:"30"}},methods:{requestConfig(){this.$axios.get("/api/config/admin").then(t=>{this.config=t.data.config,this.rewindSeekTime=this.config.rewindSeekTime.toString(),this.forwardSeekTime=this.config.forwardSeekTime.toString()}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},onSubmit(){this.config.rewindSeekTime=parseInt(this.rewindSeekTime),this.config.forwardSeekTime=parseInt(this.forwardSeekTime),this.loading=!0,this.$axios.put("/api/config/admin",{config:this.config}).then(t=>{this.loading=!1,this.showSuccNotif(t.data.message)}).catch(t=>{this.loading=!1,t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}},created(){this.requestConfig()}},cs=ls,ds=a("3786"),us=a("9564"),ps=Object(h["a"])(cs,os,ns,!1,null,null,null),ms=ps.exports;K()(ps,"components",{QForm:xa["a"],QCard:ut["a"],QToolbar:Ft["a"],QToolbarTitle:jt["a"],QList:vt["a"],QItem:D["a"],QItemSection:F["a"],QItemLabel:B["a"],QRadio:ds["a"],QInput:Bt["a"],QToggle:us["a"],QBtn:z["a"]});var hs=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("q-card",{staticClass:"q-ma-md"},[a("q-form",{on:{submit:function(e){return t.updateAdminPassword()}}},[a("q-toolbar",[a("q-toolbar-title",[t._v("修改管理员密码")])],1),a("div",{staticClass:"q-pa-sm"},[a("q-input",{attrs:{outlined:"",dense:"",type:"password",label:"新密码","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"}]},model:{value:t.adminNewPassword,callback:function(e){t.adminNewPassword=e},expression:"adminNewPassword"}}),a("q-input",{attrs:{outlined:"",dense:"",type:"password",label:"确认密码","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"},function(e){return e===t.adminNewPassword||"两次密码输入不一致"}]},model:{value:t.adminConfirmPassword,callback:function(e){t.adminConfirmPassword=e},expression:"adminConfirmPassword"}}),a("div",{staticClass:"row justify-end"},[a("q-btn",{attrs:{loading:t.loadingUpdateAdminPassword,type:"submit",color:"primary",label:"修改"}})],1)],1)],1)],1),a("q-card",{staticClass:"q-ma-md"},[a("q-form",{on:{submit:function(e){return t.addNewUser()}}},[a("q-toolbar",[a("q-toolbar-title",[t._v("添加新用户")])],1),a("div",{staticClass:"q-pa-sm"},[a("q-select",{staticClass:"q-mb-md",attrs:{dense:"",outlined:"",label:"用户组",options:t.groups},model:{value:t.newuser.group,callback:function(e){t.$set(t.newuser,"group",e)},expression:"newuser.group"}}),a("q-input",{attrs:{outlined:"",dense:"",label:"用户名",required:"","lazy-rules":"",rules:[function(t){return t.length>=5||"用户名长度至少为 5"},function(e){return!t.users.find((function(t){return t.name===e}))||"该名称已存在，用户名不能重复"}]},model:{value:t.newuser.name,callback:function(e){t.$set(t.newuser,"name",e)},expression:"newuser.name"}}),a("q-input",{attrs:{outlined:"",dense:"",label:"密码","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"}]},model:{value:t.newuser.password,callback:function(e){t.$set(t.newuser,"password",e)},expression:"newuser.password"}}),a("div",{staticClass:"row justify-end"},[a("q-btn",{attrs:{loading:t.loadingAddNewUser,type:"submit",color:"primary",label:"添加"}})],1)],1)],1)],1),a("q-card",{staticClass:"q-ma-md q-pa-sm"},[a("q-table",{attrs:{title:"所有用户",data:t.users,columns:t.columns,"row-key":"name","selected-rows-label":t.getSelectedString,selection:"multiple",selected:t.selected},on:{"update:selected":function(e){t.selected=e}}}),a("div",{staticClass:"row justify-end"},[a("q-btn",{attrs:{loading:t.loadingDeleteUsers,disable:0===t.selected.length,color:"primary",label:"删除"},on:{click:function(e){t.confirm=!0}}})],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("span",{staticClass:"q-ma-sm text-h6"},[t._v("确认删除选中用户？")])]),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确认",color:"primary"},on:{click:function(e){return t.deleteUsers()}}})],1)],1)],1)],1)},gs=[],fs={mixins:[it],data(){return{selected:[],columns:[{name:"desc",required:!0,label:"用户名",align:"left",field:"name",sortable:!0},{name:"calories",required:!0,label:"用户组",align:"center",field:"group",sortable:!0}],users:[],loadingDeleteUsers:!1,newuser:{name:"",password:"",group:"user"},groups:["user","guest"],loadingAddNewUser:!1,adminNewPassword:"",adminConfirmPassword:"",loadingUpdateAdminPassword:!1,confirm:!1}},methods:{getSelectedString(){return 0===this.selected.length?"":`${this.selected.length} record${this.selected.length>1?"s":""} selected of ${this.users.length}`},addNewUser(){this.loadingAddNewUser=!0,this.$axios.post("/api/credentials/user",{name:this.newuser.name,password:this.newuser.password,group:this.newuser.group}).then(t=>{this.users.push(this.newuser),this.loadingAddNewUser=!1,this.showSuccNotif(t.data.message),this.requestUsers()}).catch(t=>{this.loadingAddNewUser=!1,422===t.response.status?this.showErrNotif(t.response.data.errors[0].msg):403===t.response.status?this.showWarnNotif(t.response.data.error):this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`)})},deleteUsers(){this.loadingDeleteUsers=!0,this.$axios.delete("/api/credentials/user",{data:{users:this.selected}}).then(t=>{this.selected.forEach(t=>{const e=this.users.findIndex(e=>e.name===t.name);this.users.splice(e,1)}),this.loadingDeleteUsers=!1,this.showSuccNotif(t.data.message),this.requestUsers()}).catch(t=>{this.loadingDeleteUsers=!1,t.response?403===t.response.status?this.showWarnNotif(t.response.data.error):this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},updateAdminPassword(){this.loadingUpdateAdminPassword=!0,this.$axios.put("/api/credentials/user",{name:"admin",newPassword:this.adminNewPassword}).then(t=>{this.loadingUpdateAdminPassword=!1;try{this.$q.localStorage.set("jwt-token","")}catch(e){this.showErrNotif(e.message)}this.showSuccNotif(t.data.message),this.$store.state.User.auth&&(console.log("Got here"),this.$router.push("/login"))}).catch(t=>{this.loadingUpdateAdminPassword=!1,t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},requestUsers(){this.$axios.get("/api/credentials/users").then(t=>{this.users=t.data.users}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}},created(){this.requestUsers()}},vs=fs,ws=a("eaac"),qs=Object(h["a"])(vs,hs,gs,!1,null,null,null),bs=qs.exports;function ks(t,e){return e.map(e=>(e.path=t+""+e.path,e))}K()(qs,"components",{QCard:ut["a"],QForm:xa["a"],QToolbar:Ft["a"],QToolbarTitle:jt["a"],QInput:Bt["a"],QBtn:z["a"],QSelect:Ne["a"],QTable:ws["a"],QDialog:ht["a"],QCardSection:Gt["a"],QCardActions:Lt["a"]}),K()(qs,"directives",{ClosePopup:wt["a"]});const ys=[{path:"/admin",component:re,children:[{path:"",component:za},{path:"scanner",component:rs},{path:"advanced",component:ms},{path:"usermanage",component:bs}]},{path:"/",component:Zt,children:[{path:"",redirect:{name:"works"}},{path:"works",name:"works",component:Oe},{path:"work/:id",component:da},{path:"circles",props:{restrict:"circles"},component:fa},{path:"tags",props:{restrict:"tags"},component:fa},{path:"vas",props:{restrict:"vas"},component:fa},...ks("favourites",[{path:"",props:{route:"review"},component:Aa},{path:"/review",props:{route:"review"},component:Aa},...ks("/progress",[{path:"",props:{route:"progress",progress:"marked"},component:Aa},{path:"/marked",props:{route:"progress",progress:"marked"},component:Aa},{path:"/listening",props:{route:"progress",progress:"listening"},component:Aa},{path:"/listened",props:{route:"progress",progress:"listened"},component:Aa},{path:"/replay",props:{route:"progress",progress:"replay"},component:Aa},{path:"/postponed",props:{route:"progress",progress:"postponed"},component:Aa}]),{path:"/folder",props:{route:"folder"},component:Aa}])],meta:{auth:!0}},{path:"/login",component:Ca}];ys.push({path:"*",component:()=>a.e(2).then(a.bind(null,"e51e"))});var _s=ys;s["default"].use(Q["a"]);var xs=function(){const t=new Q["a"]({scrollBehavior(t,e,a){return a||{x:0,y:0}},routes:_s,mode:"history",base:"/"});return t},Ss=async function(){const t="function"===typeof P?await P({Vue:s["default"]}):P,e="function"===typeof xs?await xs({Vue:s["default"],store:t}):xs;t.$router=e;const a={router:e,store:t,render:t=>t(f),el:"#q-app"};return{app:a,store:t,router:e}},Cs=a("9483");Object(Cs["a"])("/service-worker.js",{ready(){},registered(){},cached(){},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh."),c["a"].create({message:"版本已更新",color:"primary",textColor:"white",icon:"cached",actions:[{label:"刷新",color:"white"}],timeout:1e4,onDismiss(){location.reload(!0)}})},offline(){},error(){}});var Ts=a("4971"),Es=a.n(Ts);a("24df");s["default"].component("VueSlider",Es.a);var $s=a("afa7");s["default"].use($s["a"],{plyr:{controls:["progress"]}});var Is=a("5132"),Ps=a.n(Is);async function Qs(){const{app:t,store:e,router:a}=await Ss();let i=!0;const r=t=>{i=!1,window.location.href=t},o=window.location.href.replace(window.location.origin,""),n=[void 0,void 0,void 0,void 0];for(let c=0;!0===i&&c<n.length;c++)if("function"===typeof n[c])try{await n[c]({app:t,router:a,store:e,Vue:s["default"],ssrContext:null,redirect:r,urlPath:o})}catch(l){return l&&l.url?void(window.location.href=l.url):void console.error("[Quasar] boot error:",l)}!1!==i&&new s["default"](t)}s["default"].use(new Ps.a({debug:!1,connection:"",options:{autoConnect:!1,query:{auth_token:""}}})),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&a.e(0).then(a.t.bind(null,"a0db",7)),Qs()},"31cd":function(t,e,a){},"38ca":function(t,e,a){"use strict";var s=a("9b73"),i=a.n(s);i.a},"49f7":function(t,e,a){"use strict";var s=a("70fd"),i=a.n(s);i.a},"6a18":function(t,e){},"70fd":function(t,e,a){},7661:function(t,e,a){},"7ba6":function(t,e,a){},"89d3":function(t,e,a){"use strict";var s=a("e87e"),i=a.n(s);i.a},"8e3b":function(t,e,a){},"9b73":function(t,e,a){},b3a5:function(t,e,a){"use strict";var s=a("7661"),i=a.n(s);i.a},b5fb:function(t,e){},d000:function(t,e,a){"use strict";var s=a("7ba6"),i=a.n(s);i.a},d846:function(t,e,a){"use strict";var s=a("f232"),i=a.n(s);i.a},e87e:function(t,e,a){},f232:function(t,e,a){}});
//# sourceMappingURL=app.6ad3b034.js.map